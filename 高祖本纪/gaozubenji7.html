<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>注解示范</title>
<style>
  body { 
    font-family: "宋体", serif; 
    line-height: 1.8; 
    background-color: #222;
    color: #ddd;
    font-size: 1.2em;
  }
  .text { 
    max-width: 800px; 
    margin: 20px auto; 
    padding: 20px;
  }
  .annotation-btn {
    display: inline-block;
    background: #444;
    border: 1px solid #666;
    border-radius: 3px;
    padding: 0 3px;
    margin-left: 3px;
    cursor: pointer;
    font-size: 0.7em;
    color: #55aaff;
    vertical-align: middle;
  }
  /* 弹窗背景层 */
  #overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: transparent;
    display: none;
    justify-content: center;
    align-items: flex-start;
    z-index: 9999;
    pointer-events: none;
  }
  /* 弹窗主体 */
  #popup {
    background: #333;
    max-width: 500px;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 0 12px rgba(0,0,0,0.5);
    position: absolute;
    font-size: 0.9em;
    color: #eee;
    border: 1px solid #555;
    pointer-events: auto;
    cursor: move;
  }
  #popup h3 {
    margin-top: 0;
    font-weight: normal;
    font-size: 1em;
    color: #ccc;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
  }
  #popup .close-btn {
    position: absolute;
    top: 5px; right: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    color: #999;
  }
  #popup .close-btn:hover {
    color: #ddd;
  }
  /* 拼音标注 */
  .pinyin {
    position: relative;
    display: inline-block;
    cursor: pointer;
  }
  .pinyin-popup {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #444;
    color: #fff;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.7em;
    white-space: nowrap;
    display: none;
    z-index: 100;
  }
  .pinyin:hover .pinyin-popup {
    display: block;
  }
</style>
</head>
<body>
<div class="text">

<p>初，项羽与宋义北救赵，及项羽杀宋义，代为上将军，诸将<span class="pinyin">黥<span class="pinyin-popup">qíng</span></span>布皆属，破秦将王离军，降章邯，诸侯皆附。及赵高已杀二世，使人来，欲约分王关中。沛公以为诈，乃用张良计，使郦生、陆贾往说秦将，啖以利，因袭攻武关，<span class="annotation-btn" data-type="索隐" data-content="左传云楚司马起以临上雒，谓晋人曰「将通于少习」，杜预以为商县武关也。又太康地理志武关当冠军县西，峣关在武关西也。">【索隐】</span>破之。又与秦军战于蓝田南，益张疑兵旗帜，诸所过毋得掠卤，<span class="annotation-btn" data-type="集解" data-content="应劭曰：「卤与『虏』同。」">【集解】</span>秦人憙，秦军解，因大破之。又战其北，大破之。乘胜，遂破之。</p>

<p>汉元年十月，<span class="annotation-btn" data-type="集解" data-content="如淳曰：「张苍传云以高祖十月至霸上，故因秦以十月为岁首。」">【集解】</span><span class="annotation-btn" data-type="正义" data-content="沛公乙未年十月至霸上。项羽封十八诸侯，沛公封汉王，后刘项五年战斗，汉遂灭楚，天下归汉，故却书初至霸上之月。">【正义】</span>沛公兵遂先诸侯至霸上。<span class="annotation-btn" data-type="正义" data-content="故霸陵在雍州万年县东北二十五里。汉霸陵，文帝之陵邑也，东南去霸陵十里。地理志云：「霸陵故芷阳，文帝更名。」三秦记云：「霸城，秦穆公筑为宫，因名霸城。汉于此置霸陵。」庙记云：「霸城，汉文帝筑。沛公入关，遂至霸上，即此也。」">【正义】</span>秦王子婴素车白马，系颈以组，封皇帝玺符节，<span class="annotation-btn" data-type="索隐" data-content="韦昭云：「天子印称玺，又独以玉。符，发兵符也。节，使者所拥也。」说文云：「符，信也。汉制以竹，长六寸，分而相合。」释名云：「节为号令赏罚之节也。又节毛上下相重，取象竹节。」又汉官仪云：「子婴上始皇玺，因服御之，代代传受，号曰『汉传国玺』也。」">【索隐】</span><span class="annotation-btn" data-type="正义" data-content="按：天子有六玺，皇帝行玺、皇帝之玺、皇帝信玺、天子行玺、天子之玺、天子信玺。皇帝信玺凡事皆用之，玺令施行；天子信玺以迁拜封王侯；天子之玺以发兵。皆以武都紫泥封，青囊白素里，两端无缝。三秦记云紫泥水在今成州。舆地志云汉封诏玺用紫泥，则此水之泥也。">【正义】</span>降<span class="pinyin">轵<span class="pinyin-popup">zhǐ</span></span>道旁。<span class="annotation-btn" data-type="索隐" data-content="枳音只。汉宫殿疏云枳道亭东去霸城观四里，观东去霸水百步。苏林云在长安东十三里也。">【索隐】</span><span class="annotation-btn" data-type="正义" data-content="轵音纸。括地志云：「轵道在雍州万年县东北十六里苑中。」">【正义】</span>诸将或言诛秦王。<span class="annotation-btn" data-type="索隐" data-content="楚汉春秋曰：「樊哙请杀之。」">【索隐】</span>沛公曰：「始怀王遣我，固以能宽容；且人已服降，又杀之，不祥。」乃以秦王属吏，<span class="annotation-btn" data-type="正义" data-content="属，之欲反。属，付也。">【正义】</span>遂西入咸阳。欲止宫休舍，<span class="annotation-btn" data-type="正义" data-content="休，息也。言欲居止宫殿中而息也。">【正义】</span>樊哙、张良谏，乃封秦重宝财物府库，还军霸上。召诸县父老豪桀曰：「父老苦秦苛法久矣，诽谤<span class="annotation-btn" data-type="索隐" data-content="刘伯庄、乐彦同音方未反。">【索隐】</span>者族，偶语者弃<span class="pinyin">韨<span class="pinyin-popup">fú</span></span>。<span class="annotation-btn" data-type="集解" data-content="应劭曰：「秦禁民聚语。偶，对也。」瓒曰：「始皇本纪曰『偶语经书者弃韨』。」">【集解】</span><span class="annotation-btn" data-type="索隐" data-content="按：礼云「刑人于韨，与众弃之」，故今律谓绞刑为「弃韨」是也。">【索隐】</span>吾与诸侯约，先入关者王之，吾当王关中。与父老约，法三章耳：<span class="annotation-btn" data-type="索隐" data-content="杀人，伤人及盗。">【索隐】</span>杀人者死，伤人及盗抵罪。<span class="annotation-btn" data-type="集解" data-content="应劭曰：「抵，至也，又当也。除秦酷政，但至于罪也。」李斐曰：「伤人有曲直，盗臧有多少，罪名不可豫定，故凡言抵罪，未知抵何罪也。」张晏曰：「秦法，一人犯罪，举家及邻伍坐之，今但当其身坐，合于康诰『父子兄弟罪不相及』也。」">【集解】</span><span class="annotation-btn" data-type="索隐" data-content="韦昭云：「抵，当也。谓使各当其罪。」今按：秦法有三族之刑，汉但约法三章耳，杀人者死，伤人及盗者使之抵罪，馀并不论其辜，以言省刑也。则抵训为至，杀人以外，唯伤人及盗使至罪名耳。">【索隐】</span>馀悉除去秦法。诸吏人皆案堵如故。<span class="annotation-btn" data-type="集解" data-content="应劭曰：「案，案次第；堵，墙堵也。」">【集解】</span>凡吾所以来，为父老除害，非有所侵暴，无恐！且吾所以还军霸上，待诸侯至而定约束耳。」乃使人与秦吏行县乡邑，告谕之。秦人大喜，争持牛羊酒食献飨军士。沛公又让不受，曰：「仓粟多，非乏，不欲费人。」人又益喜，唯恐沛公不为秦王。</p>

</div>

<!-- 弹窗 -->
<div id="overlay">
  <div id="popup">
    <span class="close-btn" title="关闭">×</span>
    <h3 id="popup-title"></h3>
    <div id="popup-content"></div>
  </div>
</div>

<script>
  // 获取所有注解按钮
  const buttons = document.querySelectorAll('.annotation-btn');
  const overlay = document.getElementById('overlay');
  const popup = document.getElementById('popup');
  const popupTitle = document.getElementById('popup-title');
  const popupContent = document.getElementById('popup-content');
  const closeBtn = popup.querySelector('.close-btn');

  // 拖拽功能变量
  let isDragging = false;
  let offsetX, offsetY;

  // 开始拖拽
  popup.addEventListener('mousedown', (e) => {
    if (e.target === closeBtn) return;
    isDragging = true;
    offsetX = e.clientX - popup.getBoundingClientRect().left;
    offsetY = e.clientY - popup.getBoundingClientRect().top;
    popup.style.cursor = 'grabbing';
  });

  // 拖拽中
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    popup.style.left = (e.clientX - offsetX) + 'px';
    popup.style.top = (e.clientY - offsetY) + 'px';
  });

  // 结束拖拽
  document.addEventListener('mouseup', () => {
    isDragging = false;
    popup.style.cursor = 'move';
  });

  buttons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      const type = btn.getAttribute('data-type');
      const content = btn.getAttribute('data-content');
      popupTitle.textContent = type; // 只显示类型，如【索隐】
      popupContent.innerHTML = content; // 保留完整注解内容
      
      // 计算弹出框位置
      const rect = btn.getBoundingClientRect();
      const popupWidth = popup.offsetWidth;
      const popupHeight = popup.offsetHeight;
      
      let left = rect.left + window.scrollX;
      let top = rect.top + window.scrollY - popupHeight - 10;
      
      // 确保不会超出屏幕
      if (left + popupWidth > window.innerWidth) {
        left = window.innerWidth - popupWidth - 10;
      }
      if (top < 0) {
        top = rect.bottom + window.scrollY + 10;
      }
      
      popup.style.left = left + 'px';
      popup.style.top = top + 'px';
      overlay.style.display = 'flex';
      
      e.stopPropagation(); // 防止事件冒泡
    });
  });

  closeBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
  });

  // 点击弹窗外部不关闭（因为背景是透明的）
  document.addEventListener('click', (e) => {
    if (!popup.contains(e.target)) {
      overlay.style.display = 'none';
    }
  });
</script>

</body>
</html>