<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>注解示范</title>
<style>
  body { 
    font-family: "宋体", serif; 
    line-height: 1.8; 
    background-color: #222;
    color: #ddd;
    font-size: 2.4em; /* 正文字号放大一倍 */
  }
  .text { 
    max-width: 800px; 
    margin: 20px auto; 
    padding: 20px;
  }
  .annotation-btn {
    display: inline-block;
    background: #444;
    border: 1px solid #666;
    border-radius: 3px;
    padding: 0 3px;
    margin-left: 3px;
    cursor: pointer;
    font-size: 0.7em;
    color: #55aaff;
    vertical-align: middle;
  }
  /* 弹窗背景层 */
  #overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: transparent;
    display: none;
    justify-content: center;
    align-items: flex-start;
    z-index: 9999;
    pointer-events: none;
  }
  /* 弹窗主体 */
  #popup {
    background: #333;
    max-width: 600px;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 0 12px rgba(0,0,0,0.5);
    position: absolute;
    font-size: 0.8em; /* 弹窗字号相对调整 */
    color: #eee;
    border: 1px solid #555;
    pointer-events: auto;
    cursor: move;
  }
  #popup h3 {
    margin-top: 0;
    font-weight: normal;
    font-size: 1em;
    color: #ccc;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
  }
  #popup .close-btn {
    position: absolute;
    top: 5px; right: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    color: #999;
  }
  #popup .close-btn:hover {
    color: #ddd;
  }
  /* 拼音标注 */
  .pinyin {
    position: relative;
    display: inline-block;
    cursor: pointer;
  }
  .pinyin-popup {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #444;
    color: #fff;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.7em;
    white-space: nowrap;
    display: none;
    z-index: 100;
  }
  .pinyin:hover .pinyin-popup {
    display: block;
  }
</style>
</head>
<body>
<div class="text">

<p>或说沛公<span class="annotation-btn" data-type="索隐" data-content="按：楚汉春秋云解先生云「遣守函谷，无内项王」，而张良系家云「鲰生说我」，则鲰生是小生，即解生。">【索隐】</span>曰：「秦富十倍天下，地形彊。今闻章邯降项羽，项羽乃号为雍王，王关中。今则来，沛公恐不得有此。可急使兵守函谷关，<span class="annotation-btn" data-type="正义" data-content="颜师古曰：「今桃林南有洪溜涧，古函谷也。其水北流入河，西岸犹有旧关馀迹」。西征记云：「道形如函也。其水山愿壁立数十仞，谷中容一车。」">【正义】</span>无内诸侯军，稍徵关中兵以自益，距之。」沛公然其计，从之。十一月中，项羽果率诸侯兵西，欲入关，关门闭。闻沛公已定关中，大怒，使黥布等攻破函谷关。十二月中，遂至戏。<span class="annotation-btn" data-type="正义" data-content="许宜反。">【正义】</span>沛公左司马曹无伤闻项王怒，欲攻沛公，使人言项羽曰：「沛公欲王关中，令子婴为相，珍宝尽有之。」欲以求封。<span class="annotation-btn" data-type="正义" data-content="曹无伤欲就项羽求封。">【正义】</span>亚父劝项羽击沛公。<span class="annotation-btn" data-type="索隐" data-content="范增也。项羽得范增，号曰亚父，言尊之亚于父。犹管仲，齐谓仲父。父并音甫也。">【索隐】</span>方飨士，旦日合战。是时项羽兵四十万，号百万。沛公兵十万，号二十万，力不敌。会项伯欲活张良，夜往见良，因以文谕项羽，<span class="annotation-btn" data-type="正义" data-content="项羽本纪云项伯曰「沛父不先破关中，公岂敢入乎？今人有大功，击之不义」。此以文谕之。">【正义】</span>项羽乃止。沛公从百馀骑，驱之鸿门，<span class="annotation-btn" data-type="索隐" data-content="按：姚察云在新丰古城东，未至戏水，道南有断愿、南北洞门是也。">【索隐】</span>见谢项羽。项羽曰：「此沛公左司马曹无伤言之。不然，籍何以生此！」沛公以樊哙、张良故，得解归。归，立诛曹无伤。</p>

<p>项羽遂西，屠烧咸阳秦宫室，所过无不残破。秦人大失望，然恐，不敢不服耳。</p>

<p>项羽使人还报怀王。怀王曰：「如约。」项羽怨怀王不肯令与沛公俱西入关，而北救赵，后天下约。<span class="annotation-btn" data-type="正义" data-content="怀王初约先入咸阳者王之，令羽北救赵，故失约在后也。">【正义】</span>乃曰：「怀王者，吾家项梁所立耳，非有功伐，何以得主约！本定天下，诸将及籍也。」乃详尊怀王为义帝，实不用其命。</p>

</div>

<!-- 弹窗 -->
<div id="overlay">
  <div id="popup">
    <span class="close-btn" title="关闭">×</span>
    <h3 id="popup-title"></h3>
    <div id="popup-content"></div>
  </div>
</div>

<script>
  // 获取所有注解按钮
  const buttons = document.querySelectorAll('.annotation-btn');
  const overlay = document.getElementById('overlay');
  const popup = document.getElementById('popup');
  const popupTitle = document.getElementById('popup-title');
  const popupContent = document.getElementById('popup-content');
  const closeBtn = popup.querySelector('.close-btn');

  // 拖拽功能变量
  let isDragging = false;
  let offsetX, offsetY;

  // 开始拖拽
  popup.addEventListener('mousedown', (e) => {
    if (e.target === closeBtn) return;
    isDragging = true;
    offsetX = e.clientX - popup.getBoundingClientRect().left;
    offsetY = e.clientY - popup.getBoundingClientRect().top;
    popup.style.cursor = 'grabbing';
  });

  // 拖拽中
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    popup.style.left = (e.clientX - offsetX) + 'px';
    popup.style.top = (e.clientY - offsetY) + 'px';
  });

  // 结束拖拽
  document.addEventListener('mouseup', () => {
    isDragging = false;
    popup.style.cursor = 'move';
  });

  buttons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      const type = btn.getAttribute('data-type');
      const content = btn.getAttribute('data-content');
      popupTitle.textContent = type; // 只显示类型，不显示"注解"二字
      popupContent.textContent = content;
      
      // 计算弹出框位置
      const rect = btn.getBoundingClientRect();
      const popupWidth = popup.offsetWidth;
      const popupHeight = popup.offsetHeight;
      
      let left = rect.left + window.scrollX;
      let top = rect.top + window.scrollY - popupHeight - 10;
      
      // 确保不会超出屏幕
      if (left + popupWidth > window.innerWidth) {
        left = window.innerWidth - popupWidth - 10;
      }
      if (top < 0) {
        top = rect.bottom + window.scrollY + 10;
      }
      
      popup.style.left = left + 'px';
      popup.style.top = top + 'px';
      overlay.style.display = 'flex';
      
      e.stopPropagation(); // 防止事件冒泡
    });
  });

  closeBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
  });

  // 点击弹窗外部不关闭（因为背景是透明的）
  document.addEventListener('click', (e) => {
    if (!popup.contains(e.target)) {
      overlay.style.display = 'none';
    }
  });
</script>

</body>
</html>