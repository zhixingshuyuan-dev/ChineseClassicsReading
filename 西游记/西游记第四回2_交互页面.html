<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>第四回 第二段交互阅读</title>
  <style>
    body {
      background-color: #4b3621;
      color: #f5f5dc;
      font-family: serif;
      padding: 2em;
      font-size: 2em;
    }
    .line {
      margin-bottom: 1em;
      position: relative;
    }
    .char {
      cursor: pointer;
      padding: 0 2px;
      position: relative;
    }
    .char:hover::after {
      content: attr(data-pinyin);
      position: absolute;
      bottom: 100%;
      left: 0;
      background: #222;
      color: #fff;
      padding: 2px 5px;
      font-size: 0.8em;
      white-space: nowrap;
      z-index: 10;
    }
    .popup {
      display: none;
      position: absolute;
      background: #333;
      color: #fff;
      padding: 5px;
      border-radius: 4px;
      top: 1.5em;
      left: 0;
      z-index: 100;
      font-size: 0.9em;
    }
    .translation {
      display: none;
      margin-top: 0.5em;
      font-size: 0.9em;
      background: #3a2f1d;
      padding: 0.5em;
    }
    .highlight {
      background: #a0522d;
    }
    button {
      margin-left: 0.5em;
      background: #eedc82;
      color: #333;
      font-weight: normal;
      border: none;
      padding: 1.5px 3px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.425em;
    }
    button:hover {
      background: #d2b48c;
    }
  </style>
</head>
<body>
  <h2>第四回 官封弼马心何足 名注齐天意未宁</h2>
  <h3>第二段交互阅读</h3>

  <button onclick="toggleFullReading(this)">全文朗读</button>
  <div id="content"></div>
  <div id="popup" class="popup"></div>

  <script>
    const lines = [
  "太白金星领着美猴王，到于灵霄殿外，不等宣诏，直至御前朝上礼拜。",
  "悟空挺身在旁，且不朝礼，但侧耳以听金星启奏。",
  "金星奏道：“臣领圣旨，已宣妖仙到了。”",
  "玉帝垂帘问曰：“那个是妖仙？”",
  "悟空却才躬身答应道：“老孙便是。”",
  "仙卿们都大惊失色道：“这个野猴！怎么不拜伏参见，辄敢这等答应道：‘老孙便是！’却该死了！该死了！”",
  "玉帝传旨道：“那孙悟空乃下界妖仙，初得人身，不知朝礼，且姑恕罪。”",
  "众仙卿叫声：“谢恩！”",
  "猴王却才朝上唱个大喏。",
  "玉帝宣文选武选仙卿，看那处少甚官职，着孙悟空去除授。",
  "旁边转过武曲星君，启奏道：“天宫里各宫各殿，各方各处，都不少官，只是御马监缺个正堂管事。”",
  "玉帝传旨道：“就除他做个‘弼马温’罢。”",
  "众臣叫谢恩，他也只朝上唱个大喏。",
  "玉帝又差木德星官送他去御马监到任。"
];

const pinyinMap = {
  '太': 'tài',
  '白': 'bái',
  '金': 'jīn',
  '星': 'xīng',
  '领': 'lǐng',
  '着': 'zhe',
  '美': 'měi',
  '猴': 'hóu',
  '王': 'wáng',
  '到': 'dào',
  '于': 'yú',
  '灵': 'líng',
  '霄': 'xiāo',
  '殿': 'diàn',
  '外': 'wài',
  '不': 'bù',
  '等': 'děng',
  '宣': 'xuān',
  '诏': 'zhào',
  '直': 'zhí',
  '至': 'zhì',
  '御': 'yù',
  '前': 'qián',
  '朝': 'cháo',
  '上': 'shàng',
  '礼': 'lǐ',
  '拜': 'bài',
  '悟': 'wù',
  '空': 'kōng',
  '挺': 'tǐng',
  '身': 'shēn',
  '在': 'zài',
  '旁': 'páng',
  '且': 'qiě',
  '但': 'dàn',
  '侧': 'cè',
  '耳': 'ěr',
  '以': 'yǐ',
  '听': 'tīng',
  '金': 'jīn',
  '星': 'xīng',
  '启': 'qǐ',
  '奏': 'zòu',
  '臣': 'chén',
  '领': 'lǐng',
  '圣': 'shèng',
  '旨': 'zhǐ',
  '已': 'yǐ',
  '宣': 'xuān',
  '妖': 'yāo',
  '仙': 'xiān',
  '到': 'dào',
  '了': 'le',
  '玉': 'yù',
  '帝': 'dì',
  '垂': 'chuí',
  '帘': 'lián',
  '问': 'wèn',
  '曰': 'yuē',
  '哪': 'nǎ',
  '个': 'gè',
  '是': 'shì',
  '妖': 'yāo',
  '仙': 'xiān',
  '却': 'què',
  '才': 'cái',
  '躬': 'gōng',
  '身': 'shēn',
  '答': 'dā',
  '应': 'yìng',
  '道': 'dào',
  '老': 'lǎo',
  '孙': 'sūn',
  '便': 'biàn',
  '卿': 'qīng',
  '们': 'men',
  '都': 'dōu',
  '大': 'dà',
  '惊': 'jīng',
  '失': 'shī',
  '色': 'sè',
  '这': 'zhè',
  '个': 'gè',
  '野': 'yě',
  '猴': 'hóu',
  '怎': 'zěn',
  '么': 'me',
  '拜': 'bài',
  '伏': 'fú',
  '参': 'cān',
  '见': 'jiàn',
  '辄': 'zhé',
  '敢': 'gǎn',
  '等': 'děng',
  '却': 'què',
  '该': 'gāi',
  '死': 'sǐ',
  '了': 'le',
  '传': 'chuán',
  '旨': 'zhǐ',
  '乃': 'nǎi',
  '下': 'xià',
  '界': 'jiè',
  '初': 'chū',
  '得': 'dé',
  '人': 'rén',
  '身': 'shēn',
  '不': 'bù',
  '知': 'zhī',
  '朝': 'cháo',
  '礼': 'lǐ',
  '姑': 'gū',
  '恕': 'shù',
  '罪': 'zuì',
  '众': 'zhòng',
  '叫': 'jiào',
  '声': 'shēng',
  '谢': 'xiè',
  '恩': 'ēn',
  '猴': 'hóu',
  '王': 'wáng',
  '朝': 'cháo',
  '上': 'shàng',
  '唱': 'chàng',
  '个': 'gè',
  '大': 'dà',
  '喏': 'nuò',
  '宣': 'xuān',
  '文': 'wén',
  '选': 'xuǎn',
  '武': 'wǔ',
  '仙': 'xiān',
  '卿': 'qīng',
  '看': 'kàn',
  '那': 'nà',
  '处': 'chù',
  '少': 'shǎo',
  '甚': 'shèn',
  '官': 'guān',
  '职': 'zhí',
  '着': 'zhe',
  '去': 'qù',
  '除': 'chú',
  '授': 'shòu',
  '旁': 'páng',
  '边': 'biān',
  '转': 'zhuǎn',
  '过': 'guò',
  '武': 'wǔ',
  '曲': 'qū',
  '星': 'xīng',
  '君': 'jūn',
  '启': 'qǐ',
  '奏': 'zòu',
  '天': 'tiān',
  '宫': 'gōng',
  '里': 'lǐ',
  '各': 'gè',
  '殿': 'diàn',
  '方': 'fāng',
  '都': 'dōu',
  '不': 'bù',
  '少': 'shǎo',
  '官': 'guān',
  '只': 'zhǐ',
  '是': 'shì',
  '御': 'yù',
  '马': 'mǎ',
  '监': 'jiān',
  '缺': 'quē',
  '正': 'zhèng',
  '堂': 'táng',
  '管': 'guǎn',
  '事': 'shì',
  '就': 'jiù',
  '做': 'zuò',
  '弼': 'bì',
  '马': 'mǎ',
  '温': 'wēn',
  '罢': 'bà',
  '臣': 'chén',
  '只': 'zhǐ',
  '朝': 'cháo',
  '上': 'shàng',
  '唱': 'chàng',
  '个': 'gè',
  '大': 'dà',
  '喏': 'nuò',
  '又': 'yòu',
  '差': 'chāi',
  '木': 'mù',
  '德': 'dé',
  '星': 'xīng',
  '官': 'guān',
  '送': 'sòng',
  '他': 'tā',
  '去': 'qù',
  '御': 'yù',
  '马': 'mǎ',
  '监': 'jiān',
  '到': 'dào',
  '任': 'rèn'
};



const definitionMap = {
      '那': 'that', '太': 'great', '白': 'white', '金': 'gold', '星': 'star',
      '与': 'and', '美': 'beautiful', '猴': 'monkey', '王': 'king', '同': 'together',
      '出': 'go out', '了': 'particle', '洞': 'cave', '天': 'heaven', '深': 'deep',
      '处': 'place', '一': 'one', '齐': 'together', '驾': 'ride', '云': 'cloud',
      '而': 'and', '起': 'rise', '原': 'original', '来': 'come', '悟': 'enlighten',
      '空': 'empty', '筋': 'tendon', '斗': 'fight', '比': 'compare', '众': 'many',
      '不': 'not', '十': 'very', '分': 'part', '快': 'fast', '疾': 'speedy',
      '把': 'hold', '个': 'classifier', '撇': 'leave behind', '在': 'at', '脑': 'brain',
      '后': 'back', '先': 'first', '至': 'arrive', '南': 'south', '门': 'gate',
      '外': 'outside', '正': 'just', '欲': 'want to', '收': 'withdraw', '前': 'forward',
      '进': 'enter', '被': 'by', '增': 'increase', '长': 'chief', '领': 'lead',
      '着': 'particle', '庞': 'Pang', '刘': 'Liu', '苟': 'Gou', '毕': 'Bi',
      '邓': 'Deng', '辛': 'Xin', '张': 'Zhang', '陶': 'Tao', '路': 'road',
      '大': 'big', '力': 'force', '枪': 'spear', '刀': 'knife', '剑': 'sword',
      '戟': 'halberd', '挡': 'block', '住': 'hold', '肯': 'willing',
      '老': 'old', '儿': 'man', '乃': 'indeed', '奸': 'treacherous', '诈': 'deceitful', '之': 'of', '徒': 'fellow',
      '既': 'already', '请': 'invite', '孙': 'Sun', '如': 'as', '何': 'how', '教': 'cause', '人': 'person',
      '动': 'move', '阻': 'block', '塞': 'block',
      '嚷': 'shout', '倏': 'suddenly', '觌': 'face to face', '面': 'face', '发': 'send out', '狠': 'fierce',
      '哄': 'deceive', '奉': 'receive (orders)', '玉': 'jade', '帝': 'emperor', '招': 'recruit', '安': 'appease',
      '旨': 'imperial edict', '意': 'intention', '未': 'not yet', '曾': 'ever', '到': 'arrive', '此': 'this',
      '堂': 'hall', '无': 'no', '名': 'name', '素': 'previously', '识': 'know', '擅': 'without permission',
      '入': 'enter', '今': 'now', '见': 'see', '尊': 'lord', '授': 'grant', '仙': 'immortal',
      '箓': 'register', '注': 'assign', '官': 'official', '向': 'towards', '后': 'after', '随': 'follow',
      '复': 'again', '也': 'also', '扯': 'pull', '近': 'near', '高': 'shout', '叫': 'call',
      '吏': 'official', '兵': 'soldier', '放': 'let go', '开': 'open', '者': 'person', '下': 'lower',
      '界': 'world', '宣': 'announce', '俱': 'all', '才': 'just then', '敛': 'withdraw', '退': 'retreat',
      '避': 'avoid', '始': 'then', '信': 'believe', '缓': 'slow', '步': 'step', '里': 'inside', '观': 'look around',
      '一': 'one',
'丁': 'male adult; robust; T-shaped',
'七': 'seven',
'万': 'ten thousand',
'丈': 'zhang (unit of length, 3.3m); elder',
'三': 'three',
'上': 'up; above; previous',
'下': 'down; under; next',
'不': 'not; no',
'与': 'and; with; give',
'丑': 'ugly; clown; second of the twelve Earthly Branches',
'专': 'specialized; focus on',
'且': 'moreover; yet; and',
'世': 'world; lifetime; era',
'丘': 'hill; mound; surname',
'丙': 'third of the ten Heavenly Stems',
'业': 'business; profession; occupation',
'东': 'east',
'丝': 'silk; thread',
'丞': 'assistant; official title',
'丢': 'lose; throw; discard',
'两': 'two; both',
'严': 'strict; severe',
'丧': 'funeral; mourning; lose',
'个': 'individual; single; (measure word)',
'中': 'middle; center; in',
'丰': 'abundant; plentiful; lush',
'串': 'string together; a bunch',
'临': 'approach; overlook; facing',
'为': 'for; because of; to do; to act as',
'丽': 'beautiful; pretty',
'举': 'raise; lift; recommend',
'乃': 'then; so; thus',
'久': 'long time; duration',
'么': 'interrogative particle; tiny',
'义': 'justice; righteousness; meaning',
'之': 'of; him; her; it',
'乌': 'crow; black',
'乎': 'in; at; from; particle',
'乏': 'lack; be short of',
'乐': 'happy; music',
'乒': 'ping (ping pong)',
'乓': 'pong (ping pong)',
'乔': 'tall; lofty; proud',
'乖': 'well-behaved; clever',
'乘': 'ride; take advantage of; multiply',
'乙': 'second of the ten Heavenly Stems',
'九': 'nine',
'乞': 'beg; ask for',
'也': 'also; too',
'习': 'practice; study',
'乡': 'village; country; hometown',
'书': 'book; document; letter',
'买': 'buy; purchase',
'乱': 'chaos; disorder; messy',
'乳': 'milk; breast',
'乾': 'dry; Heaven; male principle (Qian trigram)',
'了': 'particle; to finish',
'予': 'give; grant',
'争': 'contend; dispute; fight',
'事': 'matter; affair; thing',
'二': 'two',
'于': 'at; in; to; than',
'亏': 'deficient; lose',
'云': 'cloud',
'互': 'mutual; each other',
'五': 'five',
'井': 'well; neat',
'亚': 'Asia; second; inferior',
'些': 'some; several',
'亡': 'to die; perish',
'交': 'exchange; hand over; associate',
'亥': 'twelfth of the Earthly Branches',
'亦': 'also; too',
'产': 'produce; give birth; property',
'亨': 'smooth; successful',
'亩': 'unit of area (about 666.7 m²)',
  '当': 'should',
  '作': 'make',
  '用': 'use',
  '成': 'become',
  '去': 'leave',
  '里': 'in',
  '说': 'talk',
  '道': 'road',
  '也': 'too',
  '子': 'son',
  '得': 'gain',
  '于': 'to',
  '就': 'just',
  '出': 'produce',
  '时': 'season',
  '分': 'divide',
  '对': 'to',
  '生': 'give birth',
  '能': 'ability',
  '下': 'under',
  '还': 'return',
  '学': 'school',
  '都': 'capital',
  '过': 'over',
  '家': 'house',
  '自': 'from',
  '后': 'later',
  '作': 'act',
  '里': 'mile',
  '用': 'use',
  '道': 'Tao',
  '时': 'hour',
  '年': 'annual',
  '然': 'natural',
  '天': 'sky',
  '事': 'event',
  '去': 'remove',
  '起': 'rise',
  '把': 'handle',
  '对': 'face',
  '以': 'by',
  '还': 'yet',
  '作': 'compose',
  '进': 'advance',
  '多': 'more',
  '种': 'type',
  '地': 'ground',
  '而': 'but',
  '方': 'square',
  '无': 'no',
  '定': 'decide',
  '方': 'method',
  '后': 'queen',
  '气': 'air',
  '小': 'tiny',
  '学': 'science',
  '军': 'army',
  '文': 'literature',
  '力': 'strength',
  '长': 'long',
  '水': 'water',
  '工': 'work',
  '心': 'mind',
  '知': 'know',
  '同': 'together',
  '国': 'state',
  '重': 'heavy',
  '物': 'thing',
  '手': 'hand',
  '应': 'should',
  '关': 'close',
  '机': 'machine',
  '地': 'place',
  '山': 'mountain',
  '先': 'first',
  '名': 'name',
  '几': 'how many',
  '市': 'market',
  '前': 'front',
  '开': 'open',
  '体': 'body',
  '三': 'three',
  '自': 'since',
  '己': 'self',
  '高': 'high',
  '长': 'grow',
  '现': 'appear',
  '实': 'real',
  '业': 'profession',
  '理': 'reason',
     '表': 'table',
  '化': 'change',
  '老': 'old',
  '总': 'always',
  '市': 'city',
  '发': 'hair',
  '明': 'bright',
  '见': 'meet',
  '面': 'face',
  '真': 'true',
  '现': 'now',
  '通': 'pass through',
  '明': 'clear',
  '问': 'ask',
  '力': 'force',
  '它': 'it',
  '主': 'master',
  '直': 'straight',
  '定': 'fixed',
  '此': 'this',
  '外': 'outside',
  '些': 'some',
  '与': 'with',
  '活': 'live',
  '正': 'right',
  '感': 'feel',
  '想': 'think',
  '见': 'view',
  '知': 'knowledge',
  '全': 'whole',
  '再': 'again',
  '二': 'two',
  '业': 'trade',
  '动': 'move',
  '因': 'cause',
  '于': 'because of',
  '此': 'here',
  '由': 'from',
  '每': 'every',
  '百': 'hundred',
  '主': 'host',
  '意': 'meaning',
  '打': 'hit',
  '车': 'vehicle',
  '工': 'craft',
  '外': 'other',
  '风': 'wind',
  '飞': 'fly',
  '安': 'safe',
  '乐': 'happy',
  '星': 'star',
  '放': 'release',
  '物': 'object',
  '服': 'clothes',
  '空': 'empty',
  '形': 'form',
  '事': 'affair',
  '报': 'report',
  '平': 'flat',
  '走': 'walk',
  '书': 'book',
  '节': 'section',
  '色': 'color',
  '话': 'speech',
  '求': 'seek',
  '始': 'start',
  '新': 'new',
  '头': 'head',
  '身': 'body',
  '名': 'famous',
  '求': 'request',
  '重': 'repeat',
  '话': 'talk',
  '观': 'observe',
  '觉': 'sense',
  '元': 'yuan',
  '并': 'combine',
  '位': 'position',
  '求': 'demand',
  '解': 'explain',
  '注': 'note',
  '受': 'receive',
  '许': 'allow',
  '答': 'answer',
  '断': 'break',
  '细': 'fine',
  '研': 'study',
  '究': 'research',
  '须': 'must',
  '类': 'type',
  '集': 'gather',
  '标': 'mark',
  '指': 'point',
  '性': 'nature',
  '气': 'air',
  '求': 'seek',
  '况': 'situation',
  '技': 'skill',
  '层': 'layer',
  '复': 'repeat',
  '段': 'section',
  '室': 'room',
  '院': 'yard',
  '费': 'fee',
  '价': 'price',
  '态': 'state',
  '班': 'class',
  '例': 'example',
  '照': 'shine',
  '容': 'contain',
  '调': 'adjust',
  '局': 'office',
  '利': 'benefit',
  '确': 'true',
  '传': 'pass',
  '失': 'lose',
  '份': 'portion',
  '器': 'tool',
  '值': 'value',
  '按': 'press',
  '密': 'secret',
  '职': 'duty',
  '呢': 'ne',
  '消': 'disappear',
  '息': 'rest',
  '京': 'capital',
  '华': 'splendid',
  '王': 'king',
  '县': 'county',
  '静': 'quiet',
  '乘': 'ride',
  '原': 'original',
  '陈': 'display',
  '建': 'build',
  '保': 'protect',
  '持': 'hold',
  '件': 'piece',
  '艺': 'art',
  '局': 'bureau',
  '限': 'limit',
  '取': 'take',
  '展': 'display',
  '益': 'benefit',
  '验': 'examine',
  '验': 'test',
  '资': 'resources',
  '必': 'must',
  '困': 'distress',
  '士': 'scholar',
  '资': 'capital',
  '首': 'head',
  '列': 'row',
  '久': 'long time',
  '消': 'eliminate',
  '准': 'standard',
  '效': 'effect',
  '派': 'send',
  '疑': 'doubt',
  '友': 'friend',
  '术': 'art',
  '观': 'view',
  '律': 'law',
  '诉': 'complain',
  '供': 'supply',
  '根': 'root',
  '述': 'state',
  '扩': 'expand',
  '展': 'develop',
  '超': 'super',
  '越': 'cross',
  '据': 'according to',
  '策': 'strategy',
  '演': 'perform',
  '编': 'edit',
  '简': 'simple',
  '历': 'pass through',
  '专': 'special',
  '属': 'belong',
  '顾': 'look after',
  '症': 'illness',
  '丰': 'abundant',
  '参': 'participate',
  '警': 'alert',
  '责': 'duty',
  '备': 'prepare',
  '录': 'record',
  '劳': 'labor',
  '竟': 'unexpectedly',
  '略': 'brief',
  '床': 'bed',
  '县': 'county',
  '趣': 'interest',
  '众': 'crowd',
  '险': 'danger',
  '素': 'plain',
  '顺': 'smooth',
  '输': 'transport',
  '圣': 'holy',
  '功': 'achievement',
  '距': 'distance',
  '端': 'end',
  '括': 'include',
  '既': 'already',
  '未': 'not yet',
  '伤': 'injury',
  '批': 'criticize',
  '预': 'prepare',
  '泪': 'tear',
  '材': 'material',
  '调': 'tune',
  '供': 'provide',
  '案': 'case',
  '批': 'batch',
  '册': 'booklet',
  '厚': 'thick',
  '责': 'responsibility',
  '紧': 'tight',
  '舞': 'dance',
  '吸': 'inhale',
  '赠': 'give',
  '顶': 'top',
  '础': 'foundation',
  '册': 'volume',
  '救': 'rescue',
  '善': 'goodness',
  '群': 'group',
  '渐': 'gradually',
  '消': 'dispel',
  '危': 'danger',
  '皮': 'skin',
  '膜': 'membrane',
  '症': 'symptom',
  '压': 'press',
  '针': 'needle',
  '脑': 'brain',
  '汤': 'soup',
  '甚': 'very',
  '敌': 'enemy',
  '雄': 'male',
  '鸡': 'chicken',
  '鸭': 'duck',
  '扇': 'fan',
  '斜': 'slanting',
  '途': 'road',
  '誉': 'praise',
  '层': 'floor',
  '浪': 'wave',
  '源': 'source',
  '贴': 'paste',
  '阻': 'hinder',
  '暗': 'dark',
  '寄': 'send',
  '竟': 'after all',
  '授': 'give',
  '折': 'fold',
  '障': 'obstruct',
  '壳': 'shell',
  '堆': 'pile',
  '尺': 'ruler',
  '暂': 'temporary',
  '顾': 'take care',
  '帐': 'account',
  '喷': 'spout',
  '液': 'liquid',
  '币': 'currency',
  '盼': 'hope',
  '率': 'rate',
  '份': 'share',
  '仍': 'still',
  '篇': 'piece',
  '帐': 'tent',
  '遥': 'distant',
  '捕': 'catch',
  '披': 'drape',
  '舍': 'abandon',
  '俩': 'two (people)',
  '径': 'path',
  '篮': 'basket',
  '眉': 'eyebrow',
  '虽': 'although',
  '迅': 'fast',
  '袋': 'bag',
  '腰': 'waist',
  '胃': 'stomach',
  '胳': 'arm',
  '膊': 'arm',
  '肚': 'belly',
  '脏': 'dirty',
  '舒': 'comfortable',
  '屉': 'drawer',
  '脾': 'spleen',
  '肠': 'intestine',
  '胆': 'gallbladder',
  '肺': 'lung',
  '肩': 'shoulder',
  '臂': 'arm',
  '骨': 'bone',
  '髓': 'marrow',
  '肤': 'skin',
  '膝': 'knee',
  '脚': 'foot',
  '趾': 'toe',
  '踝': 'ankle',
  '踢': 'kick',
  '踹': 'kick',
  '踏': 'step on',
  '踩': 'tread',
  '踪': 'trace',
  '踪': 'track',
  '趟': 'trip',
  '跪': 'kneel',
  '跳': 'jump',
  '跃': 'leap',
  '跑': 'run',
  '趴': 'lie on stomach',
  '躺': 'lie down',
  '蹲': 'squat',
  '踩': 'stamp',
  '踩': 'trample',
  '蹄': 'hoof',
  '蹬': 'step on',
  '蹦': 'bounce',
  '蹲': 'crouch',
  '蹬': 'pedal',
  '蹦': 'jump',
  '躁': 'restless',
  '躲': 'hide',
  '躯': 'body',
  '躺': 'recline',
  '轰': 'boom',
  '轨': 'track',
  '轮': 'wheel',
  '软': 'soft',
  '轴': 'axis',
  '轻': 'light',
  '载': 'carry',
  '较': 'compare',
  '输': 'lose',
  '辩': 'debate',
  '辅': 'assist',
  '辆': 'vehicle',
  '辖': 'govern',
  '辫': 'braid',
  '辩': 'argue',
  '边': 'side',
  '辽': 'vast',
  '达': 'reach',
  '迁': 'move',
  '迎': 'welcome',
  '运': 'transport',
  '过': 'pass',
  '进': 'enter',
  '连': 'connect',
  '送': 'deliver',
  '适': 'suitable',
  '选': 'choose',
  '递': 'deliver',
  '逛': 'stroll',
  '通': 'through',
  '逗': 'tease',
  '造': 'make',
  '逼': 'force',
  '逃': 'escape',
  '逆': 'contrary',
  '选': 'select',
  '逐': 'chase',
  '遥': 'distant',
  '捕': 'catch',
  '披': 'drape',
  '舍': 'abandon',
  '俩': 'two (people)',
  '径': 'path',
  '篮': 'basket',
  '眉': 'eyebrow',
  '虽': 'although',
  '迅': 'fast',
  '袋': 'bag',
  '腰': 'waist',
  '胃': 'stomach',
  '胳': 'arm',
  '膊': 'arm',
  '肚': 'belly',
  '脏': 'dirty',
  '舒': 'comfortable',
  '屉': 'drawer',
  '脾': 'spleen',
  '肠': 'intestine',
  '胆': 'gallbladder',
  '肺': 'lung',
  '肩': 'shoulder',
  '臂': 'arm',
  '骨': 'bone',
  '髓': 'marrow',
  '肤': 'skin',
  '膝': 'knee',
  '脚': 'foot',
  '趾': 'toe',
  '踝': 'ankle',
  '踢': 'kick',
  '踹': 'kick',
  '踏': 'step on',
  '踩': 'tread',
  '踪': 'trace',
  '踪': 'track',
  '趟': 'trip',
  '跪': 'kneel',
  '跳': 'jump',
  '跃': 'leap',
  '跑': 'run',
  '趴': 'lie on stomach',
  '躺': 'lie down',
  '蹲': 'squat',
  '踩': 'stamp',
  '踩': 'trample',
  '蹄': 'hoof',
  '蹬': 'step on',
  '蹦': 'bounce',
  '蹲': 'crouch',
  '蹬': 'pedal',
  '蹦': 'jump',
  '躁': 'restless',
  '躲': 'hide',
  '躯': 'body',
  '躺': 'recline',
  '轰': 'boom',
  '轨': 'track',
  '轮': 'wheel',
  '软': 'soft',
  '轴': 'axis',
  '轻': 'light',
  '载': 'carry',
  '较': 'compare',
  '输': 'lose',
  '辩': 'debate',
  '辅': 'assist',
  '辆': 'vehicle',
  '辖': 'govern',
  '辫': 'braid',
  '辩': 'argue',
  '边': 'side',
  '辽': 'vast',
  '达': 'reach',
  '迁': 'move',
  '迎': 'welcome',
  '运': 'transport',
  '过': 'pass',
  '进': 'enter',
  '连': 'connect',
  '送': 'deliver',
  '适': 'suitable',
  '选': 'choose',
  '递': 'deliver',
  '逛': 'stroll',
  '通': 'through',
  '逗': 'tease',
  '造': 'make',
  '逼': 'force',
  '逃': 'escape',
  '逆': 'contrary',
  '选': 'select',
  '逐': 'chase',
  '锁': 'lock',
  '锄': 'hoe',
  '锅': 'pot',
  '锈': 'rust',
  '锋': 'edge',
  '锐': 'sharp',
  '错': 'wrong',
  '锡': 'tin',
  '锣': 'gong',
  '锤': 'hammer',
  '锦': 'brocade',
  '锻': 'forge',
  '键': 'key',
  '锯': 'saw',
  '锹': 'spade',
  '锻': 'temper',
  '锲': 'engrave',
  '锵': 'clang',
  '锷': 'edge (of blade)',
  '锻': 'forge',
  '锹': 'shovel',
  '镀': 'plate',
  '镇': 'town',
  '镐': 'pickaxe',
  '镜': 'mirror',
  '镣': 'shackle',
  '镰': 'sickle',
  '镶': 'inlay',
  '长': 'long',
  '门': 'door',
  '闪': 'flash',
  '闭': 'close',
  '问': 'ask',
  '闯': 'rush',
  '闰': 'leap (year)',
  '闲': 'idle',
  '间': 'between',
  '闷': 'bored',
  '闸': 'sluice',
  '闹': 'noisy',
  '闺': 'boudoir',
  '闻': 'hear',
  '闽': 'Min (Fujian)',
  '闼': 'side door',
  '闽': 'Fujian',
  '阁': 'pavilion',
  '阅': 'read',
  '阀': 'valve',
  '阂': 'barrier',
  '队': 'team',
  '防': 'defend',
  '阳': 'sun',
  '阴': 'shade',
  '阵': 'battle array',
  '阶': 'step',
  '阻': 'block',
  '阿': 'ah',
  '附': 'attach',
  '际': 'border',
  '陆': 'land',
  '陈': 'arrange',
  '陕': 'Shaanxi',
  '随': 'follow',
  '隐': 'hide',
  '隔': 'separate',
  '隙': 'crack',
  '障': 'barrier',
  '际': 'boundary',
  '难': 'difficult',
  '雀': 'sparrow',
  '雁': 'wild goose',
  '雄': 'male',
  '雅': 'elegant',
  '集': 'gather',
  '雇': 'hire',
  '雍': 'harmonious',
  '雏': 'chick',
  '雕': 'carve',
  '雨': 'rain',
  '雪': 'snow',
  '零': 'zero',
  '雷': 'thunder',
  '雾': 'fog',
  '需': 'need',
  '震': 'shake',
  '霄': 'sky',
  '霍': 'quick',
  '霎': 'in a flash',
  '霉': 'mold',
  '霸': 'tyrant',
  '霹': 'crack (of thunder)',
  '露': 'dew',
  '青': 'green',
  '静': 'quiet',
  '非': 'wrong',
  '靠': 'lean on',
  '面': 'face',
  '革': 'leather',
  '匡': 'correct',
  '匣': 'case',
  '匪': 'bandit',
  '匹': 'match',
  '区': 'district',
  '医': 'doctor',
  '匾': 'horizontal board',
  '匿': 'hide',
  '十': 'ten',
  '千': 'thousand',
  '升': 'rise',
  '午': 'noon',
  '半': 'half',
  '华': 'splendid',
  '协': 'cooperate',
  '卑': 'low',
  '卒': 'soldier',
  '卓': 'outstanding',
  '单': 'single',
  '卖': 'sell',
  '南': 'south',
  '博': 'broad',
  '卜': 'divine',
  '卞': 'impetuous',
  '占': 'occupy',
  '卡': 'card',
  '卢': 'Lu',
  '卤': 'salt',
  '卦': 'divination symbol',
  '卧': 'lie down',
  '卫': 'guard',
  '印': 'seal',
  '危': 'danger',
  '即': 'namely',
  '却': 'but',
  '卵': 'egg',
  '卷': 'roll',
  '卸': 'unload',
  '卿': 'minister',
  '厂': 'factory',
  '厄': 'adversity',
  '厅': 'hall',
  '历': 'history',
  '厉': 'strict',
  '压': 'press',
  '厌': 'dislike',
  '厕': 'toilet',
  '厘': 'centi-',
  '厚': 'thick',
  '原': 'original',
  '厢': 'side room',
  '厦': 'mansion',
  '去': 'go',
  '参': 'join',
  '又': 'again',
  '叉': 'fork',
  '及': 'reach',
  '友': 'friend',
  '双': 'pair',
  '反': 'reverse',
  '发': 'send out',
  '叔': 'uncle',
  '取': 'take',
  '受': 'receive',
  '变': 'change',
  '叙': 'narrate',
  '叛': 'rebel',
  '叠': 'fold',
  '口': 'mouth',
  '古': 'ancient',
  '句': 'sentence',
  '另': 'other',
  '只': 'only',
  '叫': 'call',
  '召': 'summon',
  '叭': 'trumpet',
  '叮': 'sting',
  '可': 'can',
  '台': 'platform',
  '史': 'history',
  '右': 'right',
  '叶': 'leaf',
  '号': 'number',
  '司': 'take charge',
  '叹': 'sigh',
  '吁': 'call on',
  '吃': 'eat',
  '各': 'each',
  '合': 'combine',
  '吉': 'lucky'
};



    const translationData = [
      {
        zh: "太白金星领着美猴王，到于灵霄殿外，不等宣诏，直至御前朝上礼拜。",
        en: "The Great White Star led the Handsome Monkey King to the outside of the Hall of Divine Majesty; without waiting for the imperial summons, they went straight to the throne to pay respects.",
        de: "Der Große Weiße Stern führte den schönen Affenkönig bis vor die Lingxiao-Halle; ohne auf die kaiserliche Aufforderung zu warten, traten sie direkt vor den Thron und verneigten sich.",
        fr: "La Grande Étoile Blanche mena le Roi Singe devant le palais Lingxiao ; sans attendre la convocation impériale, ils se présentèrent aussitôt pour rendre hommage.",
        es: "La Gran Estrella Blanca condujo al Rey Mono ante el palacio Lingxiao; sin esperar la orden imperial, se inclinaron directamente ante el trono.",
        it: "La Grande Stella Bianca condusse il Re Scimmia davanti al palazzo Lingxiao; senza attendere il decreto imperiale, si presentarono subito davanti al trono.",
        ru: "Великая Белая Звезда привела Красивого Короля-обезьян к дворцу Линсяо; не дождавшись императорского указа, они сразу поклонились перед троном."
      },
      {
        zh: "悟空挺身在旁，且不朝礼，但侧耳以听金星启奏。",
        en: "Wukong stood upright by the side, not performing the ritual bow, but listened carefully as Venus began his report.",
        de: "Wukong stand aufrecht daneben, verneigte sich nicht, sondern lauschte aufmerksam, als Venus zu berichten begann.",
        fr: "Wukong resta debout à côté, sans saluer, mais écouta attentivement le rapport de Vénus.",
        es: "Wukong permaneció erguido al lado, sin hacer la reverencia, pero escuchó atentamente mientras Venus informaba.",
        it: "Wukong stava in piedi di lato, senza inchinarsi, ma ascoltò attentamente mentre Venere riferiva.",
        ru: "Укун стоял сбоку прямо, не кланялся, а внимательно слушал, как Венера начал свой доклад."
      },
      {
        zh: "金星奏道：“臣领圣旨，已宣妖仙到了。”",
        en: "Venus reported: 'I have carried out Your Majesty's decree and summoned the demon-immortal, who has arrived.'",
        de: "Venus berichtete: 'Ich habe den kaiserlichen Befehl ausgeführt und den Dämonen-Unsterblichen gebracht.'",
        fr: "Vénus déclara : 'J'ai accompli la mission impériale, le démon-immortel est arrivé.'",
        es: "Venus informó: 'He cumplido la orden imperial y el inmortal demonio ha llegado.'",
        it: "Venere riferì: 'Ho eseguito il decreto imperiale e l'immortale demone è arrivato.'",
        ru: "Венера доложил: «Я исполнил повеление и привёл демона-бессмертного»."
      },
      {
        zh: "玉帝垂帘问曰：“那个是妖仙？”",
        en: "The Jade Emperor, from behind the curtain, asked: 'Which one is the demon-immortal?'",
        de: "Der Jadekaiser fragte von hinter dem Vorhang: 'Wer ist der Dämonen-Unsterbliche?'",
        fr: "L’Empereur de Jade demanda derrière le rideau : 'Lequel est le démon immortel ?'",
        es: "El Emperador de Jade preguntó tras la cortina: '¿Quién es el demonio inmortal?'",
        it: "L'Imperatore di Giada chiese da dietro la cortina: 'Chi è l'immortale demone?'",
        ru: "Нефритовый император спросил из-за занавеса: «Кто из них — демон-бессмертный?»"
      },
      {
        zh: "悟空却才躬身答应道：“老孙便是。”",
        en: "Wukong then bowed and replied: 'I am the one, Old Sun.'",
        de: "Wukong verbeugte sich und antwortete: 'Ich bin es, der alte Sun.'",
        fr: "Wukong s’inclina et répondit : 'C’est moi, le vieux Sun.'",
        es: "Wukong se inclinó y respondió: 'Yo soy, el viejo Sun.'",
        it: "Wukong si inchinò e rispose: 'Sono io, il vecchio Sun.'",
        ru: "Укун поклонился и ответил: «Это я, старый Сунь»."
      },
      {
        zh: "仙卿们都大惊失色道：“这个野猴！怎么不拜伏参见，辄敢这等答应道：‘老孙便是！’却该死了！该死了！”",
        en: "All the immortal officials were shocked and exclaimed: 'What a wild monkey! How dare he not bow and answer like that: “I am Old Sun!” He deserves to die! Deserves to die!'",
        de: "Alle Unsterblichen erschraken und riefen: 'Was für ein wilder Affe! Wie kann er es wagen, so zu antworten: „Ich bin der alte Sun!“ Das ist des Todes würdig! Des Todes würdig!'",
        fr: "Tous les immortels furent stupéfaits et s’écrièrent : 'Quel singe sauvage ! Comment ose-t-il répondre ainsi : “C’est moi, le vieux Sun !” Il mérite la mort ! La mort !'",
        es: "Todos los inmortales se sorprendieron: '¡Qué mono salvaje! ¿Cómo se atreve a responder así? ¡Debería ser ejecutado!'",
        it: "Tutti gli immortali furono sconvolti: 'Che scimmia selvaggia! Come osa rispondere così? Merita la morte! Merita la morte!'",
        ru: "Все бессмертные были потрясены: «Что за дикий обезьяна! Как он смеет так отвечать: „Это я, старый Сунь!“ — Достоин смерти! Достоин смерти!»"
      },
      {
        zh: "玉帝传旨道：“那孙悟空乃下界妖仙，初得人身，不知朝礼，且姑恕罪。”",
        en: "The Jade Emperor issued a decree: 'That Sun Wukong is a demon-immortal from the lower world. He has just gained a human form and does not know the court etiquette. Pardon him for now.'",
        de: "Der Jadekaiser verkündete: 'Sun Wukong ist ein Dämonen-Unsterblicher aus der Unterwelt, hat erst kürzlich menschliche Gestalt erlangt und kennt die Etikette nicht. Vergebt ihm vorerst.'",
        fr: "L’Empereur de Jade déclara : 'Sun Wukong est un démon immortel du monde inférieur, il vient d’obtenir forme humaine et ignore l’étiquette. Qu’on lui pardonne pour l’instant.'",
        es: "El Emperador de Jade ordenó: 'Ese Sun Wukong es un inmortal demonio del mundo inferior; acaba de adquirir forma humana y no conoce la etiqueta. Perdonadlo por ahora.'",
        it: "L'Imperatore di Giada disse: 'Sun Wukong è un immortale demone del mondo inferiore. Ha appena ottenuto forma umana e non conosce le regole della corte. Perdonatelo per ora.'",
        ru: "Нефритовый император издал указ: «Сунь Укун — демон-бессмертный из нижнего мира. Только что обрёл человеческий облик, не знает придворных обычаев. Простить пока»."
      },
      {
        zh: "众仙卿叫声：“谢恩！”",
        en: "All the immortals cried out: 'Thank you for your grace!'",
        de: "Alle Unsterblichen riefen: 'Danke für die Gnade!'",
        fr: "Tous les immortels s’exclamèrent : 'Merci pour votre grâce !'",
        es: "Todos los inmortales exclamaron: '¡Gracias por la gracia!'",
        it: "Tutti gli immortali esclamarono: 'Grazie per la grazia!'",
        ru: "Все бессмертные воскликнули: «Благодарим за милость!»"
      },
      {
        zh: "猴王却才朝上唱个大喏。",
        en: "Only then did the Monkey King perform a deep bow before the throne.",
        de: "Erst jetzt verbeugte sich der Affenkönig tief vor dem Thron.",
        fr: "Ce n’est qu’alors que le Roi Singe fit une grande révérence devant le trône.",
        es: "Sólo entonces el Rey Mono hizo una gran reverencia ante el trono.",
        it: "Solo allora il Re Scimmia fece un profondo inchino davanti al trono.",
        ru: "Только тогда Король-обезьяна совершил глубокий поклон перед троном."
      },
      {
        zh: "玉帝宣文选武选仙卿，看那处少甚官职，着孙悟空去除授。",
        en: "The Jade Emperor ordered the civil and military ministers to see where there were vacant posts and to appoint Sun Wukong accordingly.",
        de: "Der Jadekaiser befahl den zivilen und militärischen Ministern, nach freien Ämtern zu suchen und Sun Wukong einen Posten zu geben.",
        fr: "L’Empereur de Jade demanda à ses ministres civils et militaires de vérifier les postes vacants et d’en attribuer un à Sun Wukong.",
        es: "El Emperador de Jade ordenó a los ministros buscar un puesto vacante para Sun Wukong.",
        it: "L'Imperatore di Giada ordinò ai ministri civili e militari di vedere dove c’erano posti vacanti e di assegnarne uno a Sun Wukong.",
        ru: "Нефритовый император приказал министерствам найти вакансию для Сунь Укуна."
      },
      {
        zh: "旁边转过武曲星君，启奏道：“天宫里各宫各殿，各方各处，都不少官，只是御马监缺个正堂管事。”",
        en: "The Star Lord Wuqu stepped forward and said: 'In the heavenly palaces, there are officials everywhere, except the Imperial Stables lack a chief manager.'",
        de: "Sternengeneral Wuqu meldete: 'In allen Palästen gibt es genug Beamte, nur bei der Kaiserlichen Pferdeaufsicht fehlt ein Vorsteher.'",
        fr: "Le Seigneur des Étoiles Wuqu s’avança : 'Tous les palais ont des responsables, sauf les Écuries Impériales où il manque un chef.'",
        es: "El Señor de la Estrella Wuqu dijo: 'En los palacios celestiales no faltan funcionarios, salvo en las caballerizas imperiales.'",
        it: "Il Signore della Stella Wuqu disse: 'In tutti i palazzi ci sono funzionari, tranne che alle Scuderie Imperiali.'",
        ru: "Звёздный князь Уцю сообщил: «Во всех дворцах есть чиновники, только в императорских конюшнях не хватает управляющего»."
      },
      {
        zh: "玉帝传旨道：“就除他做个‘弼马温’罢。”",
        en: "The Jade Emperor decreed: 'Then appoint him as the Bimawen (Stable Supervisor).'",
        de: "Der Jadekaiser verfügte: 'Dann soll er der Bimawen (Stallmeister) werden.'",
        fr: "L’Empereur de Jade ordonna : 'Alors nommez-le Bimawen (surveillant des écuries)'.",
        es: "El Emperador de Jade decretó: 'Nómbrenlo supervisor de las caballerizas (Bimawen)'.",
        it: "L'Imperatore di Giada decretò: 'Allora nominatelo Bimawen, supervisore delle scuderie.'",
        ru: "Нефритовый император распорядился: «Назначить его смотрителем конюшен (Бимавэнь)»."
      },
      {
    zh: "众仙卿叫声：“谢恩！”",
    en: "All the immortals cried out: 'Thank you for your grace!'",
    de: "Alle Unsterblichen riefen: 'Danke für die Gnade!'",
    fr: "Tous les immortels s’exclamèrent : 'Merci pour votre grâce !'",
    es: "Todos los inmortales exclamaron: '¡Gracias por la gracia!'",
    it: "Tutti gli immortali esclamarono: 'Grazie per la grazia!'",
    ru: "Все бессмертные воскликнули: «Благодарим за милость!»"
  },
  {
    zh: "猴王却才朝上唱个大喏。",
    en: "Only then did the Monkey King perform a deep bow before the throne.",
    de: "Erst jetzt verbeugte sich der Affenkönig tief vor dem Thron.",
    fr: "Ce n’est qu’alors que le Roi Singe fit une grande révérence devant le trône.",
    es: "Sólo entonces el Rey Mono hizo una gran reverencia ante el trono.",
    it: "Solo allora il Re Scimmia fece un profondo inchino davanti al trono.",
    ru: "Только тогда Король-обезьяна совершил глубокий поклон перед троном."
  },
  {
    zh: "玉帝宣文选武选仙卿，看那处少甚官职，着孙悟空去除授。",
    en: "The Jade Emperor ordered the civil and military ministers to see where there were vacant posts and to appoint Sun Wukong accordingly.",
    de: "Der Jadekaiser befahl den zivilen und militärischen Ministern, nach freien Ämtern zu suchen und Sun Wukong einen Posten zu geben.",
    fr: "L’Empereur de Jade demanda à ses ministres civils et militaires de vérifier les postes vacants et d’en attribuer un à Sun Wukong.",
    es: "El Emperador de Jade ordenó a los ministros buscar un puesto vacante para Sun Wukong.",
    it: "L'Imperatore di Giada ordinò ai ministri civili e militari di vedere dove c’erano posti vacanti e di assegnarne uno a Sun Wukong.",
    ru: "Нефритовый император приказал министерствам найти вакансию для Сунь Укуна."
  },
  {
    zh: "旁边转过武曲星君，启奏道：“天宫里各宫各殿，各方各处，都不少官，只是御马监缺个正堂管事。”",
    en: "The Star Lord Wuqu stepped forward and said: 'In the heavenly palaces, there are officials everywhere, except the Imperial Stables lack a chief manager.'",
    de: "Sternengeneral Wuqu meldete: 'In allen Palästen gibt es genug Beamte, nur bei der Kaiserlichen Pferdeaufsicht fehlt ein Vorsteher.'",
    fr: "Le Seigneur des Étoiles Wuqu s’avança : 'Tous les palais ont des responsables, sauf les Écuries Impériales où il manque un chef.'",
    es: "El Señor de la Estrella Wuqu dijo: 'En los palacios celestiales no faltan funcionarios, salvo en las caballerizas imperiales.'",
    it: "Il Signore della Stella Wuqu disse: 'In tutti i palazzi ci sono funzionari, tranne che alle Scuderie Imperiali.'",
    ru: "Звёздный князь Уцю сообщил: «Во всех дворцах есть чиновники, только в императорских конюшнях не хватает управляющего»."
  },
  {
    zh: "玉帝传旨道：“就除他做个‘弼马温’罢。”",
    en: "The Jade Emperor decreed: 'Then appoint him as the Bimawen (Stable Supervisor).'",
    de: "Der Jadekaiser verfügte: 'Dann soll er der Bimawen (Stallmeister) werden.'",
    fr: "L’Empereur de Jade ordonna : 'Alors nommez-le Bimawen (surveillant des écuries)'.",
    es: "El Emperador de Jade decretó: 'Nómbrenlo supervisor de las caballerizas (Bimawen)'.",
    it: "L'Imperatore di Giada decretò: 'Allora nominatelo Bimawen, supervisore delle scuderie.'",
    ru: "Нефритовый император распорядился: «Назначить его смотрителем конюшен (Бимавэнь)»."
  },
  {
    zh: "众臣叫谢恩，他也只朝上唱个大喏。",
    en: "All the ministers cried out thanks, and Wukong again performed a bow.",
    de: "Alle Minister dankten, und Wukong verbeugte sich erneut.",
    fr: "Tous les ministres remercièrent, et Wukong fit de nouveau une révérence.",
    es: "Todos los ministros agradecieron, y Wukong volvió a inclinarse.",
    it: "Tutti i ministri ringraziarono, e Wukong fece ancora un inchino.",
    ru: "Все министры поблагодарили, и Укун снова поклонился."
  },
  {
    zh: "玉帝又差木德星官送他去御马监到任。",
    en: "The Jade Emperor then sent the Star Officer of Wood Virtue to take him to the Imperial Stables to assume his post.",
    de: "Der Jadekaiser schickte den Holz-Sternbeamten, um ihn zum Amt zu begleiten.",
    fr: "L’Empereur de Jade envoya ensuite le fonctionnaire de l’Étoile du Bois pour l’emmener aux écuries impériales.",
    es: "El Emperador de Jade envió entonces al Oficial Estrella de la Virtud de la Madera para acompañarlo a las caballerizas.",
    it: "L'Imperatore di Giada mandò l’ufficiale della Stella del Legno a condurlo alle scuderie imperiali.",
    ru: "Нефритовый император поручил чиновнику Древесной звезды проводить его на службу в императорские конюшни."
  }
];

      const contentDiv = document.getElementById('content');
    const popup = document.getElementById('popup');

    lines.forEach((line, index) => {
      const div = document.createElement('div');
      div.className = 'line';
      div.dataset.index = index;

      for (let char of line) {
        const span = document.createElement('span');
        span.className = 'char';
        span.textContent = char;
        span.dataset.pinyin = pinyinMap[char] || '';
        span.addEventListener('click', (e) => {
          popup.style.display = 'block';
          popup.style.top = `${e.pageY + 5}px`;
          popup.style.left = `${e.pageX + 5}px`;
          popup.textContent = `${char}:${definitionMap[char] || '未收录'}`;
        });
        div.appendChild(span);
      }

      const readBtn = document.createElement('button');
      readBtn.textContent = '朗读';
      readBtn.onclick = () => speakLine(index, line, readBtn);
      div.appendChild(readBtn);

      const transBtn = document.createElement('button');
      transBtn.textContent = '翻译';
      transBtn.onclick = () => {
        const transDiv = div.querySelector('.translation');
        if (transDiv) transDiv.style.display = transDiv.style.display === 'none' ? 'block' : 'none';
      };
      div.appendChild(transBtn);

      const translation = document.createElement('div');
      translation.className = 'translation';
      translation.innerHTML = `
        <button onclick="toggleTranslation(this, 'en')">英文</button>
        <button onclick="toggleTranslation(this, 'de')">德文</button>
        <button onclick="toggleTranslation(this, 'fr')">法文</button>
        <button onclick="toggleTranslation(this, 'es')">西班牙文</button>
        <button onclick="toggleTranslation(this, 'it')">意大利文</button>
        <button onclick="toggleTranslation(this, 'ru')">俄文</button>
        <div class='trans-content' data-lang='en' style='display:none;margin-top:0.5em'>${translationData[index].en}</div>
        <div class='trans-content' data-lang='de' style='display:none;margin-top:0.5em'>${translationData[index].de}</div>
        <div class='trans-content' data-lang='fr' style='display:none;margin-top:0.5em'>${translationData[index].fr}</div>
        <div class='trans-content' data-lang='es' style='display:none;margin-top:0.5em'>${translationData[index].es}</div>
        <div class='trans-content' data-lang='it' style='display:none;margin-top:0.5em'>${translationData[index].it}</div>
        <div class='trans-content' data-lang='ru' style='display:none;margin-top:0.5em'>${translationData[index].ru}</div>`;
      div.appendChild(translation);

      contentDiv.appendChild(div);
    });

    document.body.addEventListener('click', (e) => {
      if (!e.target.classList.contains('char')) popup.style.display = 'none';
    });

    let utterance = null;
    function speakLine(index, text, btn) {
      if (utterance) {
        speechSynthesis.cancel();
        utterance = null;
        btn.textContent = '朗读';
        document.querySelectorAll('.line').forEach(l => l.classList.remove('highlight'));
        return;
      }
      utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-CN';
      utterance.onend = () => {
        document.querySelector(`[data-index='${index}']`).classList.remove('highlight');
        btn.textContent = '朗读';
        utterance = null;
      };
      document.querySelector(`[data-index='${index}']`).classList.add('highlight');
      speechSynthesis.speak(utterance);
      btn.textContent = '停止';
    }

    function toggleFullReading(button) {
      if (utterance) {
        speechSynthesis.cancel();
        utterance = null;
        button.textContent = '全文朗读';
        document.querySelectorAll('.line').forEach(l => l.classList.remove('highlight'));
        return;
      }

      let i = 0;
      function readNext() {
        if (i >= lines.length) {
          utterance = null;
          button.textContent = '全文朗读';
          return;
        }
        const line = lines[i];
        const div = document.querySelector(`[data-index='${i}']`);
        document.querySelectorAll('.line').forEach(l => l.classList.remove('highlight'));
        div.classList.add('highlight');
        utterance = new SpeechSynthesisUtterance(line);
        utterance.lang = 'zh-CN';
        utterance.onend = () => {
          i++;
          readNext();
        };
        speechSynthesis.speak(utterance);
      }
      button.textContent = '停止朗读';
      readNext();
    }
  function toggleTranslation(button, lang) {
  const container = button.parentElement;
  const blocks = container.querySelectorAll('.trans-content');
  blocks.forEach(b => b.style.display = b.dataset.lang === lang ? 'block' : 'none');
}
</script>
</body>
</html>
