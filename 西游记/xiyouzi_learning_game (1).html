<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>è¥¿æ¸¸æ±‰å­—æ¢ç§˜</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .sentence {
      margin-bottom: 10px;
      font-size: 24px;
    }
    .char {
      display: inline-block;
      margin: 5px;
      padding: 10px;
      border: 1px solid #ccc;
      cursor: pointer;
      user-select: none;
    }
    .char.known {
      background-color: #eee;
      color: #888;
      pointer-events: none;
    }
    .box {
      width: 200px;
      min-height: 100px;
      border: 2px dashed #666;
      margin: 10px;
      padding: 10px;
      display: inline-block;
      vertical-align: top;
    }
    .box h3, .box h4 {
      margin: 0 0 10px 0;
    }
    #structure-container {
      display: flex;
      gap: 20px;
    }
    #structure-container .box {
      width: 600px;
    }
    #structure-container img {
      width: 100px;
      height: auto;
      margin-bottom: 5px;
    }
    #feedback {
      margin-top: 20px;
      font-size: 18px;
      color: green;
    }
    .info {
      margin-top: 10px;
      font-size: 18px;
      color: #333;
      background: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
    }
    .word-display {
      font-size: 20px;
    }
    .phrase-display {
      font-size: 48px;
      line-height: 2.2;
    }
    #nextButton {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>è¥¿æ¸¸æ±‰å­—æ¢ç§˜ï¼šé—¯å…³å­¦æ±‰å­—</h1>
  <p>å¤šæ¬¡ç‚¹å‡»åŸæ–‡æ±‰å­—ï¼Œæœ‰æƒŠå–œï¼Click characters multiple times to discover surprises!</p>

  <div class="sentence" id="sentence"></div>
  <button id="readSentenceBtn">ğŸ”Š æœ—è¯»æ•´å¥</button>
  <button id="nextButton">ä¸‹ä¸€å¥</button>
  <div class="info" id="charInfo"></div>

  <div id="structure-container">
    <div class="box" id="singleBox" ondragover="allowDrop(event)" ondrop="drop(event, 'single')">
      <h3>ç‹¬ä½“å­—</h3>
    </div>
    <div class="box" id="structure-updown" ondragover="allowDrop(event)" ondrop="drop(event, 'updown')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/f/f1/%E4%B8%8A%E4%B8%8B%E7%BB%93%E6%9E%84.svg" alt="ä¸Šä¸‹ç»“æ„">
      <h4>ä¸Šä¸‹ç»“æ„ (Top-Bottom Structure)</h4>
    </div>
    <div class="box" id="structure-leftright" ondragover="allowDrop(event)" ondrop="drop(event, 'leftright')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/1/1f/%E5%B7%A6%E5%8F%B3%E7%BB%93%E6%9E%84.svg" alt="å·¦å³ç»“æ„">
      <h4>å·¦å³ç»“æ„ (Left-Right Structure)</h4>
    </div>
    <div class="box" id="structure-enclose" ondragover="allowDrop(event)" ondrop="drop(event, 'enclose')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/0e/%E5%8C%85%E5%9B%B4%E7%BB%93%E6%9E%84.svg" alt="åŒ…å›´ç»“æ„">
      <h4>åŒ…å›´ç»“æ„ (Enclosed Structure)</h4>
    </div>
  </div>

  <div id="feedback"></div>

  <script>
    const sentences = [
      'å´è¯´é‚£é•¿è€ä¸å…«æˆ’æŒ‘ç€è¡Œæï¼Œç‰µç€é©¬ï¼Œæ…¢æ…¢çš„èµ°ã€‚',
      'å¿½å¬å¾—æ¾æ—èƒŒåæœ‰äººå«é“ï¼šâ€œé‚£æŒ‘æ‹…çš„ä¸”æ…¢èµ°ï¼â€'
    ];

    let currentSentenceIndex = 0;
    const sentenceDiv = document.getElementById('sentence');
    const infoBox = document.getElementById('charInfo');
    const nextButton = document.getElementById('nextButton');
    const readSentenceBtn = document.getElementById('readSentenceBtn');
    let knownChars = new Set();
    let learnedCount = 0;
    const clickState = {};

    const demoData = {
      'å´': { pinyin: 'quÃ¨', word: 'ä½†æ˜¯', phrase: 'æˆ‘å¾ˆç´¯å´ä¸èƒ½ä¼‘æ¯', structure: 'leftright' },
      'è¯´': { pinyin: 'shuÅ', word: 'è¯´è¯', phrase: 'ä»–è¯´äº†ä»€ä¹ˆ', structure: 'leftright' },
      'é‚£': { pinyin: 'nÃ ', word: 'é‚£ä¸ª', phrase: 'é‚£ä¸ªå­©å­å¾ˆèªæ˜', structure: 'enclose' },
      'é•¿': { pinyin: 'zhÇng', word: 'é•¿å¤§', phrase: 'ä»–é•¿å¤§äº†', structure: 'single' },
      'è€': { pinyin: 'lÇo', word: 'è€äºº', phrase: 'é‚£ä½è€äººå¾ˆæ…ˆç¥¥', structure: 'updown' },
      'ä¸': { pinyin: 'yÇ”', word: 'å‚ä¸', phrase: 'ä»–å‚ä¸äº†æ¯”èµ›', structure: 'single' },
      'å…«': { pinyin: 'bÄ', word: 'å…«æœˆ', phrase: 'å…«æœˆå¤©æ°”çƒ­', structure: 'single' },
      'æˆ’': { pinyin: 'jiÃ¨', word: 'æˆ’æŒ‡', phrase: 'ä»–æˆ´äº†æˆ’æŒ‡', structure: 'leftright' },
      'æŒ‘': { pinyin: 'tiÄo', word: 'æŒ‘é€‰', phrase: 'ä½ å¯ä»¥æŒ‘å–œæ¬¢çš„', structure: 'leftright' },
      'ç€': { pinyin: 'zhe', word: 'çœ‹ç€', phrase: 'ä»–çœ‹ç€çª—å¤–', structure: 'leftright' },
      'è¡Œ': { pinyin: 'xÃ­ng', word: 'è¡Œèµ°', phrase: 'ä»–åœ¨è·¯ä¸Šè¡Œèµ°', structure: 'leftright' },
      'æ': { pinyin: 'lÇ', word: 'è¡Œæ', phrase: 'è¡Œæå¤ªå¤šäº†', structure: 'updown' },
      'ç‰µ': { pinyin: 'qiÄn', word: 'ç‰µæ‰‹', phrase: 'ä»–ä»¬ç‰µæ‰‹èµ°è·¯', structure: 'leftright' },
      'é©¬': { pinyin: 'mÇ', word: 'é©¬è½¦', phrase: 'é©¬è½¦æ¥äº†', structure: 'single' },
      'æ…¢': { pinyin: 'mÃ n', word: 'æ…¢æ…¢', phrase: 'æ…¢æ…¢èµ°ä¸ç€æ€¥', structure: 'leftright' },
      'çš„': { pinyin: 'de', word: 'æˆ‘çš„', phrase: 'è¿™æ˜¯æˆ‘çš„ä¹¦', structure: 'leftright' },
      'èµ°': { pinyin: 'zÇ’u', word: 'èµ°è·¯', phrase: 'ä»–èµ°å¾—å¾ˆå¿«', structure: 'leftright' },
      'å¿½': { pinyin: 'hÅ«', word: 'å¿½ç„¶', phrase: 'ä»–å¿½ç„¶ç¬‘äº†', structure: 'leftright' },
      'å¬': { pinyin: 'tÄ«ng', word: 'å¬è§', phrase: 'æˆ‘å¬è§å£°éŸ³äº†', structure: 'leftright' },
      'å¾—': { pinyin: 'dÃ©', word: 'å¾—åˆ°', phrase: 'æˆ‘å¾—åˆ°äº†ä¸€æœ¬ä¹¦', structure: 'leftright' },
      'æ¾': { pinyin: 'sÅng', word: 'æ¾æ ‘', phrase: 'æ¾æ ‘é«˜å¤§', structure: 'leftright' },
      'æ—': { pinyin: 'lÃ­n', word: 'æ ‘æ—', phrase: 'æ ‘æ—å¾ˆå¯†', structure: 'leftright' },
      'èƒŒ': { pinyin: 'bÃ¨i', word: 'èƒŒå', phrase: 'èƒŒåæœ‰äººæ¥', structure: 'leftright' },
      'å': { pinyin: 'hÃ²u', word: 'åæ¥', phrase: 'åæ¥ä»–å›å®¶äº†', structure: 'leftright' },
      'æœ‰': { pinyin: 'yÇ’u', word: 'æœ‰å', phrase: 'ä»–å¾ˆæœ‰å', structure: 'leftright' },
      'äºº': { pinyin: 'rÃ©n', word: 'äººæ°‘', phrase: 'äººæ°‘ä¸‡å²', structure: 'single' },
      'å«': { pinyin: 'jiÃ o', word: 'å«å–Š', phrase: 'ä»–å¤§å£°å«å–Š', structure: 'leftright' },
      'é“': { pinyin: 'dÃ o', word: 'è¯´é“', phrase: 'ä»–è¯´é“...', structure: 'leftright' },
      'â€œ': { pinyin: '', word: '', phrase: '', structure: 'single' },
      'â€': { pinyin: '', word: '', phrase: '', structure: 'single' },
      'ä¸”': { pinyin: 'qiÄ›', word: 'ä¸”æ…¢', phrase: 'ä½ ä¸”æ…¢äº›', structure: 'leftright' },
      'æ…¢': { pinyin: 'mÃ n', word: 'æ…¢æ…¢', phrase: 'æ…¢æ…¢èµ°ä¸ç€æ€¥', structure: 'leftright' }
    };

    function renderSentence() {
      sentenceDiv.innerHTML = '';
      const sentence = sentences[currentSentenceIndex];
      for (const char of sentence.replace(/[ï¼Œã€‚ï¼šâ€œâ€ï¼]/g, '')) {
        const span = document.createElement('span');
        span.className = 'char';
        span.textContent = char;
        span.setAttribute('draggable', 'true');
        span.setAttribute('data-char', char);
        span.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', char);
        });
        span.addEventListener('click', () => handleCharClick(span, char));
        sentenceDiv.appendChild(span);
      }
    }

    nextButton.addEventListener('click', () => {
      if (currentSentenceIndex < sentences.length - 1) {
        currentSentenceIndex++;
        renderSentence();
      }
    });

    readSentenceBtn.addEventListener('click', () => {
      const text = sentences[currentSentenceIndex];
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'zh-CN';
      utter.rate = 0.75;
      speechSynthesis.speak(utter);
    });

    function handleCharClick(span, ch) {
      if (!demoData[ch]) return;
      if (!clickState[ch]) clickState[ch] = 0;
      clickState[ch]++;
      const count = clickState[ch];
      const data = demoData[ch];

      if (count === 1) {
        speakChar(ch);
      } else if (count === 2) {
        infoBox.innerHTML = `<div class='word-display'>æ‹¼éŸ³ï¼š${data.pinyin}</div>`;
        setTimeout(() => infoBox.innerHTML = '', 3000);
      } else if (count === 3) {
        speakText(`${data.word}çš„${ch}`);
      } else if (count === 4) {
        infoBox.innerHTML = `<div class='word-display'>è¯æ±‡ï¼š${data.word}</div>`;
      } else if (count === 5) {
        const phraseHtml = generatePinyinMarkup(data.phrase);
        infoBox.innerHTML = `<div class='phrase-display'>${phraseHtml}</div>`;
      } else if (count === 6) {
        speakText(data.phrase);
        learnedCount++;
        document.getElementById('feedback').innerText = `ä½ å­¦ä¼šäº† ${learnedCount} ä¸ªæ±‰å­—ï¼`;
      }
    }

    function generatePinyinMarkup(text) {
      return text.split('').map(ch => {
        const py = demoData[ch]?.pinyin || ' ';
        return `<div style='display:inline-block;text-align:center;margin:0 4px;'>
                  <div style='font-size:20px;'>${py}</div>
                  <div>${ch}</div>
                </div>`;
      }).join('');
    }

    function speakChar(char) {
      const utter = new SpeechSynthesisUtterance(char);
      utter.lang = 'zh-CN';
      utter.rate = 0.75;
      speechSynthesis.speak(utter);
    }

    function speakText(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'zh-CN';
      utter.rate = 0.75;
      speechSynthesis.speak(utter);
    }

    function allowDrop(e) {
      e.preventDefault();
    }

    function drop(e, type) {
      e.preventDefault();
      const char = e.dataTransfer.getData('text');
      if (knownChars.has(char)) return;
      const data = demoData[char];
      if (!data || !data.structure) return;

      const el = document.createElement('div');
      el.textContent = char;
      el.style.fontSize = '20px';
      el.style.padding = '5px';
      el.style.cursor = 'default';
      el.style.pointerEvents = 'none';
      e.target.appendChild(el);

      if (type === data.structure || (type === 'single' && data.structure === 'single')) {
        speakText('åˆ†ç±»æ­£ç¡®ï¼Well done!');
        document.getElementById('feedback').innerText = 'åˆ†ç±»æ­£ç¡®ï¼Well done!';
      } else {
        speakText('åˆ†ç±»é”™è¯¯ï¼Œå†è¯•ä¸€æ¬¡');
        document.getElementById('feedback').innerText = 'åˆ†ç±»é”™è¯¯ï¼Œå†è¯•ä¸€æ¬¡';
        el.style.backgroundColor = '#fcc';
      }
    }

    renderSentence();
  </script>
</body>
</html>
