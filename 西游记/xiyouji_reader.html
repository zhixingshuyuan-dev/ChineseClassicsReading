<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>西游记第四回辅助阅读器</title>
  <style>
    body { font-family: serif; padding: 2em; line-height: 2; }
    .char { cursor: pointer; padding: 0 2px; border-radius: 4px; transition: background 0.2s; }
    .char:hover { background: #eef; }
    .controls { margin-left: 1em; }
    .btn { margin-left: 0.5em; cursor: pointer; font-size: 0.9em; color: #007acc; text-decoration: underline; }
    .line { margin-bottom: 0.8em; }
  </style>
</head>
<body>
  <h2>《西游记》第四回：官封弼马心何足 名注齐天意未宁</h2>
  <div id="text"></div>

  <script>
    const data = `那太白金星与美猴王
同出了洞天深处
一齐驾云而起
原来悟空筋斗云比众不同
十分快疾
把个金星撇在脑后
先至南天门外
正欲收云前进
被增长天王领着庞刘苟毕邓辛张陶
一路大力天丁
枪刀剑戟
挡住天门
不肯放进
猴王道 这个金星老儿
乃奸诈之徒
既请老孙
如何教人动刀动枪
阻塞门路
正嚷间
金星倏到
悟空就觌面发狠道 
你这老儿 怎么哄我
被你说奉玉帝招安旨意来请
却怎么教这些人阻住天门
不放老孙进去
金星笑道 大王息怒
你自来未曾到此天堂
却又无名
众天丁又与你素不相识
他怎肯放你擅入
等如今见了天尊
授了仙录
注了官名
向后随你出入
谁复挡也
悟空道 这等说
也罢
我不进去了
金星又用手扯住道 
你还同我进去`.trim().split('\n');

    const pinyinMap = {
      "那": "nà", "太": "tài", "白": "bái", "金": "jīn", "星": "xīng",
      "与": "yǔ", "美": "měi", "猴": "hóu", "王": "wáng", "同": "tóng",
      // 更多字继续添加...
    };

    const englishMap = {
      "那": "that", "太": "grand", "白": "white", "金": "gold", "星": "star",
      "与": "and", "美": "beautiful", "猴": "monkey", "王": "king", "同": "together",
      // 更多字继续添加...
    };

    function speakChar(char) {
      const utterance = new SpeechSynthesisUtterance(char);
      utterance.lang = "zh-CN";
      utterance.voice = speechSynthesis.getVoices().find(v => v.lang === 'zh-CN' && v.name.includes("男")) || null;
      speechSynthesis.speak(utterance);
    }

    function translateLine(line) {
      // 占位函数，实际可使用翻译API或预置翻译
      return {
        en: "[Translation to English]",
        de: "[Übersetzung auf Deutsch]",
        fr: "[Traduction en français]",
        ja: "[日本語訳]",
        ko: "[한국어 번역]",
        vi: "[Dịch sang tiếng Việt]",
        it: "[Traduzione in italiano]",
        es: "[Traducción al español]",
        pt: "[Tradução em português]",
        la: "[Translatio Latina]",
        gr: "[Ελληνική μετάφραση]",
        sa: "[संस्कृत अनुवादः]"
      }
    }

    function createLine(lineText) {
      const line = document.createElement('div');
      line.className = 'line';
      for (let char of lineText) {
        if (char === ' ') {
          line.appendChild(document.createTextNode(' '));
          continue;
        }
        const span = document.createElement('span');
        span.className = 'char';
        span.textContent = char;
        span.dataset.click = '0';
        span.onclick = () => {
          let state = parseInt(span.dataset.click);
          if (state === 0) {
            span.textContent = `${char} (${pinyinMap[char] || '?'})`;
          } else if (state === 1) {
            speakChar(char);
          } else if (state === 2) {
            span.textContent = `${char} (${englishMap[char] || '?'})`;
          }
          span.dataset.click = (state + 1) % 3;
        };
        line.appendChild(span);
      }
      const btnRead = document.createElement('span');
      btnRead.className = 'btn';
      btnRead.textContent = '🔊朗读 Read';
      btnRead.onclick = () => speakChar(lineText);

      const btnTrans = document.createElement('span');
      btnTrans.className = 'btn';
      btnTrans.textContent = '🌐翻译 Translate';
      btnTrans.onclick = () => {
        const t = translateLine(lineText);
        alert(Object.entries(t).map(([lang, txt]) => `${lang}: ${txt}`).join("\n"));
      };

      const controls = document.createElement('span');
      controls.className = 'controls';
      controls.appendChild(btnRead);
      controls.appendChild(btnTrans);
      line.appendChild(controls);

      return line;
    }

    const container = document.getElementById('text');
    data.forEach(line => container.appendChild(createLine(line)));
  </script>
</body>
</html>
