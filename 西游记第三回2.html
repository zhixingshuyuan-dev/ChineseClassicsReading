<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>西游记阅读器</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
      font-family: "微软雅黑", sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #textContainer {
      text-align: center;
      max-width: 90%;
      padding: 20px;
    }

    .sentence {
      font-size: 72px; /* Reduced by 20% from 90px */
      line-height: 1.5;
      margin: 0 auto;
      opacity: 0;
      transition: opacity 1.5s ease-in-out;
    }

    .sentence.active {
      opacity: 1;
    }

    .hanzi {
      display: inline-block;
      min-width: 72px; /* Reduced by 20% from 90px */
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.5s ease-out;
      cursor: pointer;
      position: relative;
    }

    .hanzi.show {
      opacity: 1;
      transform: scale(1);
    }

    .hanzi.highlight {
      color: #00fff7;
      text-shadow: 0 0 10px #00fff7;
    }

    .hanzi .pinyin {
      position: absolute;
      top: -40px; /* Adjusted for smaller font */
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px; /* Reduced by 20% from 30px */
      background: rgba(0,0,0,0.7);
      padding: 3px 7px;
      border-radius: 5px;
      display: none;
    }

    .hanzi:hover .pinyin {
      display: block;
    }

    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
    }

    button {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid white;
      padding: 15px 25px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 28px;
      transition: background 0.3s;
      width: 60px;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    button:hover {
      background: rgba(255,255,255,0.3);
    }

    #startOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 1000;
    }

    #startButton {
      padding: 22px 45px;
      font-size: 36px;
      background: #00fff7;
      color: #0f2027;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #startButton:hover {
      transform: scale(1.05);
      background: #00e6d6;
    }

    #overlayText {
      margin-bottom: 30px;
      font-size: 42px;
      color: #fff;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="textContainer"></div>
  <div id="controls">
    <button id="prevBtn" title="上一句"><i class="fas fa-arrow-left"></i></button>
    <button id="pauseBtn" title="暂停"><i class="fas fa-pause"></i></button>
    <button id="nextBtn" title="下一句"><i class="fas fa-arrow-right"></i></button>
  </div>

  <div id="startOverlay">
    <div id="overlayText">西游记阅读器</div>
    <button id="startButton"><i class="fas fa-play"></i></button> <!-- Removed Chinese characters -->
  </div>

  <script>
    // 原始文本
    const rawText = `你看这猴王，分开水道，径回铁板桥头，撺将上去，只见四个老猴，领着众猴，都在桥边等候。忽然见悟空跳出波外，身上更无一点水湿，金灿灿的，走上桥来。唬得众猴一齐跪下道：“大王，好华彩耶！好华彩耶！”悟空满面春风，高登宝座，将铁棒竖在当中。那些猴不知好歹，都来拿那宝贝，却便似蜻蜓撼铁树，分毫也不能禁动。一个个咬指伸舌道：“爷爷呀！这般重，亏你怎的拿来也！”悟空近前，舒开手一把挝起，对众笑道：“物各有主。这宝贝镇于海藏中，也不知几千百年，可可的今岁放光。龙王只认做是块黑铁，又唤做天河镇底神珍。那厮每都扛抬不动，请我亲去拿之。那时此宝有二丈多长，斗来粗细；被我挝他一把，意思嫌大，他就小了许多；再教小些，他又小了许多；再教小些，他又小了许多；急对天光看处，上有一行字，乃‘如意金箍棒，一万三千五百斤’。你都站开，等我再叫他变一变着。”他将那宝贝颠在手中，叫：“小！小！小！”即时就小做一个绣花针儿相似，可以揌在耳朵里面藏下。众猴骇然，叫道：“大王！还拿出来耍耍！”猴王真个去耳朵里拿出，托放掌上叫：“大！大！大！”即又大做斗来粗细，二丈长短。他弄到欢喜处，跳上桥，走出洞外，将宝贝攥在手中，做一个法天象地的神通，把腰一躬，叫声“长！”他就长的高万丈，头如泰山，腰如峻岭，眼如闪电，口似血盆，牙如剑戟；手中那棒，上抵三十三天，下至十八层地狱，把些虎豹狼虫，满山群怪，七十二洞妖王，都唬得磕头礼拜，战兢兢魄散魂飞。霎时收了法像，将宝贝还变做个绣花针儿，藏在耳内，复归洞府。慌得那各洞妖王，都来参贺。
 
此时遂大开旗鼓，响振铜锣。广设珍馐百味，满斟椰液萄浆，与众饮宴多时。却又依前教演。猴王将那四个老猴封为健将；将两个赤尻马猴唤做马、流二元帅；两个通背猿猴唤做崩、芭二将军。将那安营下寨，赏罚诸事，都付与四键将维持。他放下心，日逐腾云驾雾，遨游四海，行乐千山。施武艺，遍访英豪；弄神通，广交贤友。此时又会了个七弟兄，乃牛魔王、蛟魔王、鹏魔王、狮驼王、猕猴王、【犭禺】狨王，连自家美猴王七个。日逐讲文论武，走斝传觞，弦歌吹舞，朝去暮回，无般儿不乐。把那个万里之遥，只当庭闱之路，所谓点头径过三千里，扭腰八百有馀程。
 
一日，在本洞吩咐四健将安排筵宴，请六王赴饮，杀牛宰马，祭天享地，着众怪跳舞欢歌，俱吃得酩酊大醉。送六王出去，却又赏劳大小头目，在铁板桥边松阴之下，霎时间睡着。四健将领众围护，不敢高声。
 
只见那美猴王睡里见两人拿一张批文，上有“孙悟空”三字，走近身，不容分说，套上绳，就把美猴王的魂灵儿索了去，踉踉跄跄，直带到一座城边。猴王渐觉酒醒，忽抬头观看，那城上有一铁牌，牌上有三个大字，乃“幽冥界”。美猴王顿然醒悟道：“幽冥界乃阎王所居，何为到此？”那两人道：“你今阳寿该终，我两人领批，勾你来也。”猴王听说，道：“我老孙超出三界外，不在五行中，已不伏他管辖，怎么朦胧（这里是糊涂的意思），又敢来勾我？”那两个勾死人只管扯扯拉拉，定要拖他进去。那猴王恼起性来，耳朵中掣出宝贝，幌一幌，碗来粗细；略举手，把两个勾死人打为肉酱。自解其索，丢开手，轮着棒，打入城中。唬得那牛头鬼东躲西藏，马面鬼南奔北跑，众鬼卒奔上森罗殿，报着：“大王！祸事！祸事！外面一个毛脸雷公，打将来了！”慌得那十代冥王急整衣来看，见他相貌凶恶，即排下班次，应声高叫道：“上仙留名！上仙留名！”猴王道：“你既认不得我，怎么差人来勾我？”十王道：“不敢！不敢！想是差人差了。”猴王道：“我本是花果山水帘洞天生圣人孙悟空。你等是什么官位？”十王躬身道：“我等是阴间天子十代冥王。”悟空道：“快报名来，免打！”十王道：“我等是秦广王、初江王、宋帝王、仵官王、阎罗王、平等王、泰山王、都市王、卞城王、转轮王。”悟空道：“汝等既登王位，乃灵显感应之类，为何不知好歹？我老孙修仙了道，与天齐寿，超升三界之外，跳出五行之中，为何着人拘我？”十王道：“上仙息怒。普天下同名同姓者多，敢是那勾死人错走了也？”悟空道：“胡说！胡说！常言道：‘官差吏差，来人不差。’你快取生死簿子来我看！”十王闻言，即请上殿查看。
 
悟空执着如意棒，径登森罗殿上，正中间南面坐上。十王即命掌案的判官取出文簿来查。那判官不敢怠慢，便到司房里，捧出五六簿文书并十类簿子，逐一查看。裸虫、毛虫、羽虫、昆虫、鳞介之属，俱无他名。又看到猴属之类，原来这猴似人相，不入人名；似裸虫，不居国界；似走兽，不伏麒麟管；似飞禽，不受凤凰辖。另有个簿子，悟空亲自检阅，直到那魂字一千三百五十号上，方注着孙悟空名字，乃天产石猴，该寿三百四十二岁，善终。悟空道：“我也不记寿数几何，且只消了名字便罢！取笔过来！”那判官慌忙捧笔，饱掭浓墨。悟空拿过簿子，把猴属之类，但有名者，一概勾之。捽下簿子道：“了帐！了帐！今番不伏你管了！”一路棒，打出幽冥界。那十王不敢相近，都去翠云宫，同拜地藏王菩萨，商量启表，奏闻上天，不在话下。
 
这猴王打出城中，忽然绊着一个草纥繨，跌了个躘踵，猛的醒来，乃是南柯一梦。才觉伸腰，只闻得四健将与众猴高叫道：“大王，吃了多少酒，睡这一夜，还不醒来？”悟空道：“睡还小可，我梦见两个人，来此勾我，把我带到幽冥界城门之外，却才醒悟，是我显神通，直嚷到森罗殿，与那十王争吵，将我们的生死簿看了，但有我等名号，俱是我勾了，都不伏那厮所辖也。”众猴磕头礼谢。自此，山猴都有不老者，以阴司无名故也。美猴王言毕前事，四健将报知各洞妖王，都来贺喜。不几日，六个义兄弟，又来拜贺；一闻销名之故，又个个欢喜，每日聚乐不提。
 
却表启那个高天上圣大慈仁者玉皇大天尊玄穹高上帝，一日，驾坐金阙云宫灵霄宝殿，聚集文武仙卿早朝之际，忽有邱弘济真人启奏道：“万岁，通明殿外，有东海龙王敖广进表，听天尊宣诏。”玉皇传旨：着宣来。
 
敖广宣至灵霄殿下，礼拜毕。旁有引奏仙童，接上表文。玉皇从头看过。表曰：
 
水元下界东胜神洲东海小龙臣敖广启奏大天圣主玄穹高上帝君：近因花果山生、水帘洞住妖仙孙悟空者，欺虐小龙，强坐水宅，索兵器，施法施威；要披挂，骋凶骋势。惊伤水族，唬走龟鼍。南海龙战战兢兢；西海龙凄凄惨惨，北海龙缩首归降。臣敖广舒身下拜，献神珍之铁棒，凤翅之金冠，与那锁子甲、步云履，以礼送出。他仍弄武艺，显神通，但云‘聒噪！聒噪！’果然无敌，甚为难制。臣今启奏，伏望圣裁。恳乞天兵，收此妖孽，庶使海岳清宁，下元安泰。奉奏。
 
圣帝览毕，传旨：“着龙神回海，朕即遣将擒拿。”老龙王顿首谢去。下面又有葛仙翁天师启奏道：“万岁，有冥司秦广王赍奉幽冥教主地藏王菩萨表文进上。”旁有传言玉女，接上表文，玉皇亦从头看过。表曰：
 
“幽冥境界，乃地之阴司。天有神而地有鬼，阴阳转轮；禽有生而兽有死，反复雌雄。生生化化，孕女成男，此自然之数，不能易也。今有花果山水廉洞天产妖猴孙悟空，逞强行凶，不服拘唤。弄神通，打绝九幽鬼使；恃势力，惊伤十代慈王。大闹罗森，强销名号。致使猴属之类无拘，猕猴之畜多寿；寂灭轮回，各无生死。贫僧具表，冒渎天威。伏乞调遣神兵，收降此妖，整理阴阳，永安地府。谨奏。”
 
玉皇览毕，传旨：“着冥君回归地府，朕即遣将擒拿。”秦广王亦顿首谢去。
 
大天尊宣众文武仙卿，问曰：“这妖猴是几年生育，何代出生，却就这般有道？”一言未已，班中闪出千里眼、顺风耳道：“这猴乃三百年前天产石猴。当时不以为然，不知这几年在何方修炼成仙，降龙伏虎，强销死籍也。”玉帝道：“那路神将下界收伏？”言未已，班中闪出太白长庚星，俯首启奏道：“上圣三界中，凡有九窍者，皆可修仙。奈此猴乃天地育成之体，日月孕就之身，他也顶天履地，服露餐霞；今既修成仙道，有降龙伏虎之能，与人何以异哉？臣启陛下，可念生化之慈恩，降一道招安圣旨，把他宣来上届，授他一个大小官职，与他籍名在箓，拘束此间，若受天命，后再升赏；若违天命，就此擒拿。一则不动众劳师，二则收仙有道也。”玉帝闻言甚喜，道：“依卿所奏。”即着文曲星官修诏，着太白金星招安。
 
金星领了旨，出南天门外，按下祥云，直至花果山水帘洞。对众小猴道：“我乃天差天使，有圣旨在此，请你大王上届，快快报知！”
 
洞外小猴，一层层传至洞天深处，道：“大王，外面有一老人，背着一角文书，言是上天差来的天使，有圣旨请你也。”美猴王听得大喜，道：“我这两日，正思量要上天走走，却就有天使来请。”叫：“快请进来！”
 
猴王急整衣冠，门外迎接。金星径入当中，面南立定道：“我是西方太白金星，奉玉帝招安圣旨，下界请你上天，拜受仙录。”悟空笑道：“多感老星降临。”教：“小的们！安排筵宴款待。”金星道：“圣旨在身，不敢久留；就请大王同往，待荣迁之后，再从容叙也。”悟空道：“承光顾，空退！空退！”即唤四健将，分付：“谨慎教演儿孙，待我上天去看看路，却好带你们上去同居住也。”四健将领诺。这猴王与金星纵起云头，升在空霄之上，正是那：
 
高迁上品天仙位，名列云班宝录中。
 
毕竟不知授个甚么官爵，且听下回分解。`;

    // 智能分句函数，以句号、叹号、问号、分号、冒号、省略号为分割点
    function splitSentences(text) {
      // 先按段落分割
      const paragraphs = text.split(/\n\s*\n/);
      let sentences = [];
      
      paragraphs.forEach(para => {
        if (!para.trim()) return;
        
        // 处理段落内的分句
        const splitPattern = /([^。！？；：…]+[。！？；：…」』"']?)/g;
        let matches;
        while ((matches = splitPattern.exec(para)) !== null) {
          const sentence = matches[0].trim();
          if (sentence) {
            // 处理对话中的分行问题
            if (sentence.includes('"') || sentence.includes('"') || sentence.includes('"')) {
              sentences.push(sentence);
            } else {
              // 普通句子按标点分割
              sentences.push(...sentence.split(/(?<=[。！？；：…])/).filter(s => s.trim()));
            }
          }
        }
      });
      
      // 过滤空句子和过短的句子（如单独的标点）
      return sentences.filter(s => s.trim().length > 1);
    }

    // 获取分句后的文本
    const sentences = splitSentences(rawText);

    const pinyinMap = {
      // ... (pinyin map remains the same as in the original file)
      // (I've omitted the pinyin map here for brevity, but it should be included in the actual implementation)
    };

    // 全局变量
    let currentSentenceIndex = 0;
    let isPlaying = false;
    let timeoutId = null;
    const textContainer = document.getElementById('textContainer');
    const prevBtn = document.getElementById('prevBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const nextBtn = document.getElementById('nextBtn');
    const startButton = document.getElementById('startButton');
    const startOverlay = document.getElementById('startOverlay');
    const synth = window.speechSynthesis;

    // 初始化函数
    function init() {
      // 设置控制按钮事件
      setupControls();
      
      // 开始按钮事件
      startButton.addEventListener('click', startReading);
    }

    function setupControls() {
      prevBtn.addEventListener('click', () => {
        if (currentSentenceIndex > 0) {
          currentSentenceIndex--;
          showCurrentSentence();
        }
      });

      pauseBtn.addEventListener('click', () => {
        isPlaying = !isPlaying;
        pauseBtn.innerHTML = isPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
        if (isPlaying) {
          showCurrentSentence();
        } else {
          clearTimeout(timeoutId);
        }
      });

      nextBtn.addEventListener('click', () => {
        if (currentSentenceIndex < sentences.length - 1) {
          currentSentenceIndex++;
          showCurrentSentence();
        }
      });
    }

    function startReading() {
      startOverlay.style.display = 'none';
      isPlaying = true;
      showCurrentSentence();
      
      // 激活语音合成API（有些浏览器需要用户交互后才能使用）
      const utterance = new SpeechSynthesisUtterance('');
      utterance.volume = 0;
      synth.speak(utterance);
    }

    function speakCharacter(char) {
      if (synth.speaking) {
        synth.cancel();
      }
      
      const utterance = new SpeechSynthesisUtterance(char);
      utterance.lang = 'zh-CN';
      utterance.rate = 0.8;
      synth.speak(utterance);
    }

    function showCurrentSentence() {
      clearTimeout(timeoutId);
      
      const sentence = sentences[currentSentenceIndex];
      textContainer.innerHTML = '';
      
      const sentenceEl = document.createElement('div');
      sentenceEl.className = 'sentence';
      textContainer.appendChild(sentenceEl);
      
      // 逐个添加汉字
      const chars = sentence.split('');
      chars.forEach((char, index) => {
        const hanzi = document.createElement('span');
        hanzi.className = 'hanzi';
        hanzi.textContent = char;
        
        // 添加拼音元素
        const pinyin = document.createElement('span');
        pinyin.className = 'pinyin';
        pinyin.textContent = pinyinMap[char] || '';
        hanzi.appendChild(pinyin);
        
        // 添加点击事件
        hanzi.addEventListener('click', () => {
          speakCharacter(char);
          // 高亮效果
          document.querySelectorAll('.hanzi.highlight').forEach(el => {
            el.classList.remove('highlight');
          });
          hanzi.classList.add('highlight');
        });
        
        sentenceEl.appendChild(hanzi);
        
        // 逐个显示汉字
        setTimeout(() => {
          hanzi.classList.add('show');
        }, index * 300);
      });
      
      // 显示整句
      setTimeout(() => {
        sentenceEl.classList.add('active');
      }, 500);
      
      // 自动播放下一句
      if (isPlaying) {
        const sentenceDuration = chars.length * 300 + 3000;
        timeoutId = setTimeout(() => {
          if (currentSentenceIndex < sentences.length - 1) {
            currentSentenceIndex++;
          } else {
            currentSentenceIndex = 0; // 循环回到第一句
          }
          showCurrentSentence();
        }, sentenceDuration);
      }
    }

    // 页面加载后初始化
    window.addEventListener('load', init);
  </script>
</body>
</html>