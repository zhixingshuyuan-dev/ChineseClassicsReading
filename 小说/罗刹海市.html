<!DOCTYPE html>
<!-- saved from url=(0072)https://xingyuze.github.io/chinesischLernen/edit/edit/liaozhaozhiyi.html -->
<html lang="de-DE" style="transition-property: none; margin-right: 0px;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>罗刹海市</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #121212;
            color: #E0E0E0;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        .header h1 {
            display: inline-block;
            margin: 0;
            color: #FFFFFF;
            font-size: 28px;
        }
        .edit-title-btn {
            background-color: transparent;
            border: none;
            color: #64B5F6;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            display: none;
        }
        .topic {
            background-color: #1E1E1E;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .topic-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }
        .topic-title {
            font-size: 20px;
            font-weight: bold;
            color: #64B5F6;
        }
        .topic-content {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 18px;
        }
        .reply {
            background-color: #2D2D2D;
            border-left: 3px solid #64B5F6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
        }
        .reply-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            align-items: center;
        }
        .reply-topic {
            font-weight: bold;
            cursor: pointer;
            color: #64B5F6;
            font-size: 16px;
        }
        .reply-content {
            margin: 10px 0;
            font-size: 16px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #64B5F6;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #64B5F6;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #2D2D2D;
            color: #E0E0E0;
        }
        button {
            background-color: #64B5F6;
            color: #121212;
            border: none;
            padding: 4px 7.5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        button:hover {
            background-color: #42A5F5;
        }
        .delete-btn {
            background-color: #E53935;
            color: white;
            border: none;
            padding: 2.5px 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            margin-left: 10px;
        }
        .delete-btn:hover {
            background-color: #C62828;
        }
        .hidden {
            display: none;
        }
        .admin-panel {
            background-color: #1E1E1E;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .login-form {
            margin-bottom: 20px;
        }
        .read-aloud-btn {
            background-color: transparent;
            border: none;
            color: #64B5F6;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        .read-aloud-btn.active {
            color: #FF9800;
        }
        .save-status {
            color: #4CAF50;
            font-size: 12px;
            margin-left: 10px;
            display: none;
        }
    </style>
<style id="ReanimatedPredefinedWebAnimationsStyle"></style><style id="ReanimatedCustomWebAnimationsStyle"></style></head>
<body>
    <div class="header">
        <h1 id="main-title">罗刹海市</h1>
        <button id="edit-title-btn" class="edit-title-btn" style="display: none;">编辑标题</button>
        <span id="save-status" class="save-status" style="display: none;">已保存</span>
    </div>

    <div id="admin-panel" class="admin-panel">
        <h3>管理员登录</h3>
        <div class="login-form">
            <div class="form-group">
                <label for="admin-password">管理员密码</label>
                <input type="password" id="admin-password" placeholder="输入密码">
            </div>
            <button id="login-btn">登录</button>
            <button id="logout-btn" class="hidden">退出</button>
        </div>
    </div>

    <div id="topics-container"><div class="topic">
                    <div class="topic-header">
                        <div class="topic-title">第一段</div>
                        <div></div>
                    </div>
                    <div class="topic-content">馬驥，字龍媒，賈人子。美丰姿，少倜儻，喜歌舞，輒從梨園子弟，以錦帕纏頭，美如好女，因複有“俊人”之號。十四歲，入郡庠，即知名。父衰老，罷賈而居，謂生曰：“數卷書，饑不可煮，寒不可衣。吾兒可仍繼父賈。” 馬由是稍稍權子母。 <button id="read-aloud-topic-1" class="read-aloud-btn" onclick="toggleReadAloud(&#39;馬驥，字龍媒，賈人子。美丰姿，少倜儻，喜歌舞，輒從梨園子弟，以錦帕纏頭，美如好女，因複有“俊人”之號。十四歲，入郡庠，即知名。父衰老，罷賈而居，謂生曰：“數卷書，饑不可煮，寒不可衣。吾兒可仍繼父賈。” 馬由是稍稍權子母。&#39;, this)">朗读</button></div>
                    <div class="replies" id="replies-1"><div class="reply" id="reply-101">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(101)">
                                    白话文 ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            马骥，字龙媒，商人之子。他容貌俊美，少年时就潇洒不羁，喜欢唱歌跳舞，常常跟着戏班学艺，用绸帕包着头，漂亮得像女子一样，因此又被人称为“俊人”。十四岁时，进入郡学读书，便已闻名。父亲年老，停止经商回家，对他说：“几本书，饿了不能煮来吃，冷了也不能当衣服穿。你还是继承我的生意吧。” 马骥于是开始学习经商。 <button id="read-aloud-reply-101" class="read-aloud-btn" onclick="toggleReadAloud(&#39;马骥，字龙媒，商人之子。他容貌俊美，少年时就潇洒不羁，喜欢唱歌跳舞，常常跟着戏班学艺，用绸帕包着头，漂亮得像女子一样，因此又被人称为“俊人”。十四岁时，进入郡学读书，便已闻名。父亲年老，停止经商回家，对他说：“几本书，饿了不能煮来吃，冷了也不能当衣服穿。你还是继承我的生意吧。” 马骥于是开始学习经商。&#39;, this)">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-102">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(102)">
                                    English ▼
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content">
                            Ma Ji, styled Long Mei, was the son of a merchant. Handsome and charming in his youth, he loved singing and dancing and often joined theatrical troupes, wearing silk scarves around his head. He was so beautiful that he was called “the handsome man.” At fourteen, he entered the local academy and quickly became famous. His father, now old, gave up business and advised him: “Books won’t feed you when you’re hungry or keep you warm when it’s cold. You should continue your father’s trade.” Ma thus gradually began to learn commerce. <button id="read-aloud-reply-102" class="read-aloud-btn" onclick="toggleReadAloud(&#39;Ma Ji, styled Long Mei, was the son of a merchant. Handsome and charming in his youth, he loved singing and dancing and often joined theatrical troupes, wearing silk scarves around his head. He was so beautiful that he was called “the handsome man.” At fourteen, he entered the local academy and quickly became famous. His father, now old, gave up business and advised him: “Books won’t feed you when you’re hungry or keep you warm when it’s cold. You should continue your father’s trade.” Ma thus gradually began to learn commerce.&#39;, this)">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-103">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(103)">
                                    Français ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            Ma Ji, surnommé Long Mei, était le fils d’un marchand. Beau et charmant dès son jeune âge, il aimait chanter et danser, fréquentant souvent des troupes théâtrales et portant un foulard de soie sur la tête. Tellement séduisant qu’il fut appelé « l’homme élégant ». À quatorze ans, il entra à l’académie locale et devint rapidement célèbre. Son père, vieillissant, abandonna le commerce et lui dit : « Les livres ne nourrissent pas quand on a faim ni ne réchauffent quand il fait froid. Tu devrais reprendre mon métier de marchand. » Ma commença donc à apprendre le négoce. <button id="read-aloud-reply-103" class="read-aloud-btn" onclick="toggleReadAloud(&#39;Ma Ji, surnommé Long Mei, était le fils d’un marchand. Beau et charmant dès son jeune âge, il aimait chanter et danser, fréquentant souvent des troupes théâtrales et portant un foulard de soie sur la tête. Tellement séduisant qu’il fut appelé « l’homme élégant ». À quatorze ans, il entra à l’académie locale et devint rapidement célèbre. Son père, vieillissant, abandonna le commerce et lui dit : « Les livres ne nourrissent pas quand on a faim ni ne réchauffent quand il fait froid. Tu devrais reprendre mon métier de marchand. » Ma commença donc à apprendre le négoce.&#39;, this)">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-104">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(104)">
                                    Deutsch ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            Ma Ji, genannt Long Mei, war der Sohn eines Kaufmanns. Schön und charismatisch schon in jungen Jahren liebte er Gesang und Tanz und schloss sich oft Theatertourneen an, wobei er ein seidenes Tuch um den Kopf trug. Seine Schönheit war so außergewöhnlich, dass man ihn auch „den Schönen“ nannte. Mit vierzehn trat er in die lokale Akademie ein und wurde rasch bekannt. Sein Vater, nun alt, gab das Handwerk auf und sagte zu ihm: „Bücher können dich nicht ernähren, wenn du hungrig bist, noch dich wärmen, wenn es kalt ist. Du solltest besser meinen Beruf als Kaufmann übernehmen.“ Daraufhin begann Ma langsam mit dem Handel. <button id="read-aloud-reply-104" class="read-aloud-btn" onclick="toggleReadAloud(&#39;Ma Ji, genannt Long Mei, war der Sohn eines Kaufmanns. Schön und charismatisch schon in jungen Jahren liebte er Gesang und Tanz und schloss sich oft Theatertourneen an, wobei er ein seidenes Tuch um den Kopf trug. Seine Schönheit war so außergewöhnlich, dass man ihn auch „den Schönen“ nannte. Mit vierzehn trat er in die lokale Akademie ein und wurde rasch bekannt. Sein Vater, nun alt, gab das Handwerk auf und sagte zu ihm: „Bücher können dich nicht ernähren, wenn du hungrig bist, noch dich wärmen, wenn es kalt ist. Du solltest besser meinen Beruf als Kaufmann übernehmen.“ Daraufhin begann Ma langsam mit dem Handel.&#39;, this)">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-105">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(105)">
                                    日本語 ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            馬驥、字は龍媒、商人の子なり。美しく風采があり、若かりし頃より洒脱にして、歌舞を好み、しばしば梨園の子弟と共にあり、錦の手巾で頭を巻き、美女のように美しいことから、「俊人」とも呼ばれた。十四歳のとき、郡庠に入り、たちまち名を成した。父は年老いて商いをやめ、住むようになり、彼に言った。「数冊の書物では、腹が減っても煮ることはできず、寒くても着ることはできない。お前の場合は、父の商いを受け継げばよい。」馬はこのため、次第に商売を始めた。 <button id="read-aloud-reply-105" class="read-aloud-btn" onclick="toggleReadAloud(&#39;馬驥、字は龍媒、商人の子なり。美しく風采があり、若かりし頃より洒脱にして、歌舞を好み、しばしば梨園の子弟と共にあり、錦の手巾で頭を巻き、美女のように美しいことから、「俊人」とも呼ばれた。十四歳のとき、郡庠に入り、たちまち名を成した。父は年老いて商いをやめ、住むようになり、彼に言った。「数冊の書物では、腹が減っても煮ることはできず、寒くても着ることはできない。お前の場合は、父の商いを受け継げばよい。」馬はこのため、次第に商売を始めた。&#39;, this)">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-106">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(106)">
                                    한국어 ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            마적은 자가 룽메이(龙媒)이고 상인의 아들이었다. 용모가 준수하고 젊어서부터 활달하여 춤과 노래를 즐겼으며 종종 희원(梨园)의 제자들과 함께 있었는데 비단 수건으로 머리를 감싸 쓰고 있었으니 여자보다도 더 아름다워서 '준인(俊人)'이라는 별칭도 있었다. 열네 살 때 군학에 입학하여 곧 이름을 날렸다. 아버지는 늙어 장사를 그만두고 집에 머물며 말했다. "몇 권의 책으로 배고플 때는 요리할 수 없고 추울 때는 옷으로 입을 수도 없다. 너는 내 장사를 이어야겠다." 마적은 이때부터 천천히 장사 준비를 시작하였다. <button id="read-aloud-reply-106" class="read-aloud-btn" onclick="toggleReadAloud(&#39;마적은 자가 룽메이(龙媒)이고 상인의 아들이었다. 용모가 준수하고 젊어서부터 활달하여 춤과 노래를 즐겼으며 종종 희원(梨园)의 제자들과 함께 있었는데 비단 수건으로 머리를 감싸 쓰고 있었으니 여자보다도 더 아름다워서 \&#39;준인(俊人)\&#39;이라는 별칭도 있었다. 열네 살 때 군학에 입학하여 곧 이름을 날렸다. 아버지는 늙어 장사를 그만두고 집에 머물며 말했다. " 몇="" 권의="" 책으로="" 배고플="" 때는="" 요리할="" 수="" 없고="" 추울="" 옷으로="" 입을="" 수도="" 없다.="" 너는="" 내="" 장사를="" 이어야겠다."="" 마적은="" 이때부터="" 천천히="" 장사="" 준비를="" 시작하였다.',="" this)"="">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-107">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(107)">
                                    ba chữ ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            Mã Kỷ, tự là Long Mai, con nhà thương nhân. Đẹp trai và phóng khoáng từ nhỏ, thích ca múa, thường xuyên học theo các nghệ sĩ trong đoàn hát, lấy khăn gấm quấn đầu, đẹp như thiếu nữ, nên người ta còn gọi là “người tuấn tú”. Mười bốn tuổi vào trường quận học, lập tức nổi tiếng. Cha già yếu, bỏ nghề buôn bán ở nhà, bảo con rằng: “Vài cuốn sách không thể nấu ăn khi đói, cũng chẳng mặc ấm được khi lạnh. Con nên tiếp tục sự nghiệp buôn bán của cha.” Mã từ đó dần bắt đầu học làm ăn. <button id="read-aloud-reply-107" class="read-aloud-btn" onclick="toggleReadAloud(&#39;Mã Kỷ, tự là Long Mai, con nhà thương nhân. Đẹp trai và phóng khoáng từ nhỏ, thích ca múa, thường xuyên học theo các nghệ sĩ trong đoàn hát, lấy khăn gấm quấn đầu, đẹp như thiếu nữ, nên người ta còn gọi là “người tuấn tú”. Mười bốn tuổi vào trường quận học, lập tức nổi tiếng. Cha già yếu, bỏ nghề buôn bán ở nhà, bảo con rằng: “Vài cuốn sách không thể nấu ăn khi đói, cũng chẳng mặc ấm được khi lạnh. Con nên tiếp tục sự nghiệp buôn bán của cha.” Mã từ đó dần bắt đầu học làm ăn.&#39;, this)">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-108">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(108)">
                                    Español ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            Ma Ji, apodado Long Mei, era hijo de un comerciante. Era apuesto y desde joven desenvuelto y amaba cantar y bailar, por lo que solía acompañar a compañías teatrales, usando pañuelos de seda para cubrirse la cabeza. Su belleza era tan extraordinaria que también fue llamado "el hombre elegante". A los catorce años entró en la academia local y rápidamente se hizo famoso. Su padre, al envejecer, dejó el comercio y le dijo: "Los libros no te alimentan cuando tienes hambre ni te mantienen caliente cuando hace frío. Deberías continuar con mi negocio." Así, Ma comenzó gradualmente a aprender el arte del comercio. <button id="read-aloud-reply-108" class="read-aloud-btn" onclick="toggleReadAloud(&#39;Ma Ji, apodado Long Mei, era hijo de un comerciante. Era apuesto y desde joven desenvuelto y amaba cantar y bailar, por lo que solía acompañar a compañías teatrales, usando pañuelos de seda para cubrirse la cabeza. Su belleza era tan extraordinaria que también fue llamado " el="" hombre="" elegante".="" a="" los="" catorce="" años="" entró="" en="" la="" academia="" local="" y="" rápidamente="" se="" hizo="" famoso.="" su="" padre,="" al="" envejecer,="" dejó="" comercio="" le="" dijo:="" "los="" libros="" no="" te="" alimentan="" cuando="" tienes="" hambre="" ni="" mantienen="" caliente="" hace="" frío.="" deberías="" continuar="" con="" mi="" negocio."="" así,="" ma="" comenzó="" gradualmente="" aprender="" arte="" del="" comercio.',="" this)"="">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-109">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(109)">
                                    Italiano ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            Bagliore del tramonto: Nell’opera Prefazione al Padiglione del Principe Teng di Wang Bo si legge: “Il tramonto vola insieme all’oca selvatica solitaria.” In seguito, un letterato, ancorato sul fiume di notte, udì un canto provenire dall’acqua. Disse: “Perché non dire: ‘Tramonto e oca volano insieme, le acque autunnali e il cielo infinito hanno lo stesso colore’?” Il fantasma svanì. <button id="read-aloud-reply-109" class="read-aloud-btn" onclick="toggleReadAloud(&#39;Bagliore del tramonto: Nell’opera Prefazione al Padiglione del Principe Teng di Wang Bo si legge: “Il tramonto vola insieme all’oca selvatica solitaria.” In seguito, un letterato, ancorato sul fiume di notte, udì un canto provenire dall’acqua. Disse: “Perché non dire: ‘Tramonto e oca volano insieme, le acque autunnali e il cielo infinito hanno lo stesso colore’?” Il fantasma svanì.&#39;, this)">朗读</button>
                        </div>
                    </div><div class="reply" id="reply-110">
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(110)">
                                    Русский ▶
                                </span>
                                
                            </div>
                        </div>
                        <div class="reply-content" style="display:none;">
                            Закатное сияние: В прозаическом сочинении Ван Бо «Проза павильона князя Тэна» говорится: «Закатное сияние летит вместе с одинокой дикой гусыней». Позже один учёный ночевал у реки и услышал пение из воды. Он сказал: «Почему бы не сказать: “Закат и дикая гусыня летят вместе, осенняя вода и бескрайнее небо сливаются в один цвет”?» После этого призрак исчез. <button id="read-aloud-reply-110" class="read-aloud-btn" onclick="toggleReadAloud(&#39;Закатное сияние: В прозаическом сочинении Ван Бо «Проза павильона князя Тэна» говорится: «Закатное сияние летит вместе с одинокой дикой гусыней». Позже один учёный ночевал у реки и услышал пение из воды. Он сказал: «Почему бы не сказать: “Закат и дикая гусыня летят вместе, осенняя вода и бескрайнее небо сливаются в один цвет”?» После этого призрак исчез.&#39;, this)">朗读</button>
                        </div>
                    </div></div>
                    
                </div></div>

    <div class="topic hidden" id="new-topic-form">
        <h3>发表新主题</h3>
        <div class="form-group">
            <label for="new-topic-title">主题标题</label>
            <input type="text" id="new-topic-title" placeholder="输入主题标题">
        </div>
        <div class="form-group">
            <label for="new-topic-content">主题内容</label>
            <textarea id="new-topic-content" rows="4" placeholder="输入主题内容"></textarea>
        </div>
        <button id="submit-topic">发表主题</button>
    </div>

    <script>
        // 论坛数据
        let forumData = {
            mainTitle: "简易BBS论坛",
            topics: [
                {
                    id: 1,
                    title: "示例主题",
                    content: "这是一个示例主题内容",
                    replies: [
                        {
                            id: 101,
                            language: "English",
                            content: "This is an example translation",
                            collapsed: false
                        }
                    ]
                }
            ]
        };

        // 当前状态
        let currentState = {
            editingTopic: null,
            editingReply: null,
            isAdmin: false,
            adminPassword: "admin123", // 默认管理员密码
            currentSpeech: null,       // 当前朗读对象
            speakingElement: null      // 当前朗读的元素
        };

        // 显示保存状态
        function showSaveStatus() {
            const statusElement = document.getElementById('save-status');
            statusElement.style.display = 'inline';
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 2000);
        }

        // 初始化数据
        function initData() {
            const savedData = localStorage.getItem('forumData');
            if (savedData) {
                forumData = JSON.parse(savedData);
                document.getElementById('main-title').textContent = forumData.mainTitle;
                document.title = forumData.mainTitle;
                showSaveStatus();
            } else {
                saveData();
            }
        }

        // 保存数据到本地存储
        function saveData() {
            forumData.mainTitle = document.getElementById('main-title').textContent;
            localStorage.setItem('forumData', JSON.stringify(forumData));
            document.title = forumData.mainTitle;
            showSaveStatus();
        }

        // 朗读文本（可切换）
        function toggleReadAloud(text, element) {
            // 如果正在朗读当前元素，则停止
            if (currentState.speakingElement === element && window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                element.classList.remove('active');
                currentState.speakingElement = null;
                return;
            }
            
            // 如果正在朗读其他内容，先停止
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                if (currentState.speakingElement) {
                    currentState.speakingElement.classList.remove('active');
                }
            }
            
            // 开始朗读新内容
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = element.textContent.includes('English') ? 'en-US' : 'zh-CN';
                
                utterance.onstart = function() {
                    element.classList.add('active');
                    currentState.speakingElement = element;
                };
                
                utterance.onend = function() {
                    element.classList.remove('active');
                    if (currentState.speakingElement === element) {
                        currentState.speakingElement = null;
                    }
                };
                
                window.speechSynthesis.speak(utterance);
            } else {
                alert('您的浏览器不支持语音朗读功能');
            }
        }

        // 渲染论坛内容
        function renderForum() {
            const container = document.getElementById('topics-container');
            container.innerHTML = '';

            // 更新标题编辑按钮的显示状态
            document.getElementById('edit-title-btn').style.display = 
                currentState.isAdmin ? 'inline-block' : 'none';

            if (forumData.topics.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'topic';
                emptyMsg.textContent = '没有找到相关主题';
                container.appendChild(emptyMsg);
                return;
            }

            forumData.topics.forEach(topic => {
                const topicElement = document.createElement('div');
                topicElement.className = 'topic';
                
                let adminControls = '';
                if (currentState.isAdmin) {
                    adminControls = `
                        <button class="delete-btn" onclick="deleteTopic(${topic.id})">删除主题</button>
                        <button onclick="editTopic(${topic.id})">编辑主题</button>
                    `;
                }
                
                // 添加朗读按钮
                const readAloudBtnId = `read-aloud-topic-${topic.id}`;
                const readAloudBtn = `<button id="${readAloudBtnId}" class="read-aloud-btn" onclick="toggleReadAloud('${topic.content.replace(/'/g, "\\'")}', this)">朗读</button>`;
                
                topicElement.innerHTML = `
                    <div class="topic-header">
                        <div class="topic-title">${topic.title}</div>
                        <div>${adminControls}</div>
                    </div>
                    <div class="topic-content">${topic.content} ${readAloudBtn}</div>
                    <div class="replies" id="replies-${topic.id}"></div>
                    ${currentState.isAdmin ? `
                    <div class="form-group">
                        <label for="reply-topic-${topic.id}">语种Language</label>
                        <input type="text" id="reply-topic-${topic.id}" placeholder="输入语种">
                    </div>
                    <div class="form-group">
                        <textarea id="reply-content-${topic.id}" rows="3" placeholder="输入内容"></textarea>
                    </div>
                    <button onclick="addReply(${topic.id})">提交</button>
                    ` : ''}
                `;
                container.appendChild(topicElement);

                const repliesContainer = document.getElementById(`replies-${topic.id}`);
                topic.replies.forEach(reply => {
                    let replyAdminControls = '';
                    if (currentState.isAdmin) {
                        replyAdminControls = `
                            <button class="delete-btn" onclick="deleteReply(${topic.id}, ${reply.id})">删除</button>
                            <button onclick="editReply(${topic.id}, ${reply.id})">编辑</button>
                        `;
                    }
                    
                    // 为回复添加朗读按钮
                    const replyReadAloudBtnId = `read-aloud-reply-${reply.id}`;
                    const replyReadAloudBtn = `<button id="${replyReadAloudBtnId}" class="read-aloud-btn" onclick="toggleReadAloud('${reply.content.replace(/'/g, "\\'")}', this)">朗读</button>`;
                    
                    const replyElement = document.createElement('div');
                    replyElement.className = 'reply';
                    replyElement.id = `reply-${reply.id}`;
                    replyElement.innerHTML = `
                        <div class="reply-header">
                            <div>
                                <span class="reply-topic" onclick="toggleReply(${reply.id})">
                                    ${reply.language} ${reply.collapsed ? '▶' : '▼'}
                                </span>
                                ${replyAdminControls}
                            </div>
                        </div>
                        <div class="reply-content" ${reply.collapsed ? 'style="display:none;"' : ''}>
                            ${reply.content} ${replyReadAloudBtn}
                        </div>
                    `;
                    repliesContainer.appendChild(replyElement);
                });
            });
        }

        // 编辑主标题
        function editMainTitle() {
            if (!currentState.isAdmin) return;
            
            const currentTitle = document.getElementById('main-title').textContent;
            const newTitle = prompt('输入新的论坛标题:', currentTitle);
            
            if (newTitle !== null && newTitle.trim() !== '') {
                document.getElementById('main-title').textContent = newTitle.trim();
                saveData();
            }
        }

        // 切换回复的折叠状态
        function toggleReply(replyId) {
            for (const topic of forumData.topics) {
                const reply = topic.replies.find(r => r.id === replyId);
                if (reply) {
                    reply.collapsed = !reply.collapsed;
                    break;
                }
            }
            renderForum();
        }

        // 添加新主题
        document.getElementById('submit-topic').addEventListener('click', function() {
            if (!currentState.isAdmin) return;
            
            const title = document.getElementById('new-topic-title').value.trim();
            const content = document.getElementById('new-topic-content').value.trim();
            
            if (title && content) {
                if (currentState.editingTopic) {
                    // 编辑现有主题
                    const topic = forumData.topics.find(t => t.id === currentState.editingTopic);
                    if (topic) {
                        topic.title = title;
                        topic.content = content;
                    }
                    currentState.editingTopic = null;
                    document.getElementById('submit-topic').textContent = '发表主题';
                } else {
                    // 添加新主题
                    const newTopic = {
                        id: forumData.topics.length > 0 ? Math.max(...forumData.topics.map(t => t.id)) + 1 : 1,
                        title: title,
                        content: content,
                        replies: []
                    };
                    forumData.topics.push(newTopic);
                }
                
                document.getElementById('new-topic-title').value = '';
                document.getElementById('new-topic-content').value = '';
                saveData();
                renderForum();
            } else {
                alert('请填写主题标题和内容');
            }
        });

        // 编辑主题
        function editTopic(topicId) {
            if (!currentState.isAdmin) return;
            
            const topic = forumData.topics.find(t => t.id === topicId);
            if (topic) {
                currentState.editingTopic = topicId;
                document.getElementById('new-topic-title').value = topic.title;
                document.getElementById('new-topic-content').value = topic.content;
                document.getElementById('submit-topic').textContent = '更新主题';
                document.getElementById('new-topic-form').classList.remove('hidden');
                document.getElementById('new-topic-form').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // 删除主题
        function deleteTopic(topicId) {
            if (!currentState.isAdmin) return;
            
            if (confirm('确定要删除这个主题吗？所有译文也将被删除。')) {
                forumData.topics = forumData.topics.filter(t => t.id !== topicId);
                saveData();
                renderForum();
            }
        }

        // 添加回复
        function addReply(topicId) {
            if (!currentState.isAdmin) return;
            
            const topic = forumData.topics.find(t => t.id === topicId);
            if (!topic) return;
            
            const languageInput = document.getElementById(`reply-topic-${topicId}`).value.trim();
            const contentInput = document.getElementById(`reply-content-${topicId}`).value.trim();
            
            if (languageInput && contentInput) {
                if (currentState.editingReply) {
                    // 编辑现有回复
                    for (const t of forumData.topics) {
                        const reply = t.replies.find(r => r.id === currentState.editingReply);
                        if (reply) {
                            reply.language = languageInput;
                            reply.content = contentInput;
                            break;
                        }
                    }
                    currentState.editingReply = null;
                } else {
                    // 添加新回复
                    const newReply = {
                        id: topic.replies.length > 0 ? Math.max(...topic.replies.map(r => r.id)) + 1 : 100 + topic.replies.length + 1,
                        language: languageInput,
                        content: contentInput,
                        collapsed: false
                    };
                    topic.replies.push(newReply);
                }
                
                document.getElementById(`reply-topic-${topicId}`).value = '';
                document.getElementById(`reply-content-${topicId}`).value = '';
                saveData();
                renderForum();
            } else {
                alert('请填写语种和内容');
            }
        }

        // 编辑回复
        function editReply(topicId, replyId) {
            if (!currentState.isAdmin) return;
            
            for (const topic of forumData.topics) {
                const reply = topic.replies.find(r => r.id === replyId);
                if (reply) {
                    currentState.editingReply = replyId;
                    document.getElementById(`reply-topic-${topicId}`).value = reply.language;
                    document.getElementById(`reply-content-${topicId}`).value = reply.content;
                    document.getElementById(`reply-content-${topicId}`).scrollIntoView({ behavior: 'smooth' });
                    break;
                }
            }
        }

        // 删除回复
        function deleteReply(topicId, replyId) {
            if (!currentState.isAdmin) return;
            
            if (confirm('确定要删除这个译文吗？')) {
                const topic = forumData.topics.find(t => t.id === topicId);
                if (topic) {
                    topic.replies = topic.replies.filter(r => r.id !== replyId);
                    saveData();
                    renderForum();
                }
            }
        }

        // 管理员登录
        document.getElementById('login-btn').addEventListener('click', function() {
            const password = document.getElementById('admin-password').value;
            if (password === currentState.adminPassword) {
                currentState.isAdmin = true;
                document.getElementById('login-btn').classList.add('hidden');
                document.getElementById('logout-btn').classList.remove('hidden');
                document.getElementById('new-topic-form').classList.remove('hidden');
                renderForum();
            } else {
                alert('密码错误');
            }
        });

        // 管理员退出
        document.getElementById('logout-btn').addEventListener('click', function() {
            currentState.isAdmin = false;
            document.getElementById('login-btn').classList.remove('hidden');
            document.getElementById('logout-btn').classList.add('hidden');
            document.getElementById('admin-password').value = '';
            document.getElementById('new-topic-form').classList.add('hidden');
            renderForum();
        });

        // 初始化事件监听
        document.getElementById('edit-title-btn').addEventListener('click', editMainTitle);

        // 页面关闭前停止所有朗读
        window.addEventListener('beforeunload', function() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
        });

        // 初始化
        initData();
        renderForum();
    </script>

</body><div data-klarna-plugin-views-container=""><template shadowrootmode="closed"><div style="position: fixed; left: 0px; top: 0px; z-index: 2147483647;"><div class="css-175oi2r" style="opacity: 0; transform: scale(0.88) translateX(2292px) translateY(-74.8px);"><div class="react-draggable" style="top: 24px; right: 24px; border-radius: 16px; height: 94vh; background-color: rgb(245, 245, 247); position: fixed; width: 375px; z-index: 2; will-change: transform; transition: transform 120ms ease-out allow-discrete, opacity 300ms, display 300ms; display: none; opacity: 0; box-sizing: border-box; transform: translate(0px, 0px);"><div style="flex: 1 1 0%; display: flex; height: 100vh; align-items: center; justify-content: center;"><svg viewBox="0 0 100 100" style="width: 100px; height: 100px;"><style>@keyframes klarna-loader-animation-dotted {0%, 100% { transform: translateY(0); }50% { transform: translateY(-10%); }}</style><circle cx="11.5" cy="50" r="11.5" style="fill: rgb(11, 5, 29); animation: 0.8s ease-in-out 0s infinite normal none running klarna-loader-animation-dotted;"></circle><circle cx="50" cy="50" r="11.5" style="fill: rgb(11, 5, 29); animation: 0.8s ease-in-out 0.2s infinite normal none running klarna-loader-animation-dotted;"></circle><circle cx="88.5" cy="50" r="11.5" style="fill: rgb(11, 5, 29); animation: 0.8s ease-in-out 0.4s infinite normal none running klarna-loader-animation-dotted;"></circle></svg></div><div style="box-sizing: border-box; display: flex; align-items: stretch; flex-direction: column; flex-shrink: 0; border-style: solid; border-width: 0px; position: absolute; z-index: 0; min-height: 0px; min-width: 0px; transition-property: opacity; transition-timing-function: ease-out; transition-duration: 300ms; transition-delay: 10ms; inset: 0px; opacity: 0;"><div class="dragHandle" style="box-sizing: border-box; display: flex; align-items: stretch; flex-direction: column; flex-shrink: 0; border-style: solid; border-width: 0px; position: absolute; z-index: 999; min-height: 0px; min-width: 0px; cursor: move; height: 40px; width: 44%; align-self: flex-start; margin-left: 45px;"></div><iframe src="chrome-extension://hfapbcheiepjppjbnkphkmegjlipojba/klapp.html?klapp-id=drawer" allow="clipboard-read; clipboard-write;" style="background-color: rgb(255, 255, 255); border: none; height: 100%; width: 100%; border-radius: 16px; box-shadow: rgba(0, 0, 0, 0.5) 0px 0px 10px 0px;"></iframe></div></div></div><div style="box-sizing: border-box; display: flex; align-items: stretch; flex-direction: column; flex-shrink: 0; border-style: solid; border-width: 0px; position: fixed; z-index: 0; min-height: 0px; min-width: 0px; animation-duration: 250ms; animation-fill-mode: both; box-shadow: rgba(0, 0, 0, 0.5) 0px 0px 10px 0px; max-height: calc(-60px + 100vh); width: 198px; padding: 12px 10px; background-color: rgb(245, 245, 247); border-radius: 16px; transition-property: opacity, transform, width, height; transition-timing-function: ease-out, ease-out, ease-in-out, ease-in-out; transition-duration: 250ms, 250ms, 150ms, 150ms; pointer-events: none; opacity: 0; left: max(30px, min(30px, -248px + 100vw)); top: max(30px, min(30px, -74px + 100vh)); transform: translateY(5px);"><div role="button" aria-disabled="false" tabindex="0" style="display: flex; flex-direction: column; cursor: pointer;"><div style="box-sizing: border-box; display: flex; align-items: center; flex-direction: column; flex-shrink: 0; border-style: solid; border-width: 0px; position: absolute; z-index: 0; min-height: 0px; min-width: 0px; justify-content: center; width: 24px; height: 24px; border-radius: 24px; background-color: rgb(243, 243, 247); box-shadow: rgba(0, 0, 0, 0.1) 0px 6px 12px; top: -20px; right: -20px;"><svg aria-hidden="true" role="img" viewBox="0 0 20 20" height="20" width="20"><g fill="none" fill-rule="evenodd" transform="translate(4, 4) scale(1)"><path d="m10.945 2.045-.99-.99L6 5.01 2.045 1.055l-.99.99L5.01 6 1.055 9.955l.99.99L6 6.99l3.955 3.955.99-.99L6.99 6l3.955-3.955Z" fill="rgba(11, 5, 29, 1)" style="transition: fill 0.2s;"></path></g></svg></div></div></div></div></template></div></html>