<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西游记第五回问答挑战</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c 0%, #b21f1f 50%, #fdbb2d 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #3a1c71, #5c2a9d);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        
        .text-section {
            flex: 3;
            min-width: 300px;
            padding: 20px;
            border-right: 1px solid #eee;
        }
        
        .qa-section {
            flex: 2;
            min-width: 300px;
            padding: 20px;
        }
        
        h2 {
            color: #3a1c71;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3a1c71;
        }
        
        .text-container {
            position: relative;
        }
        
        .original-text {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            line-height: 1.8;
            margin-bottom: 20px;
            border: 1px solid #eee;
            font-size: 32px; /* 字体放大一倍 */
            text-align: justify;
        }
        
        .original-text .highlight {
            background-color: #ffeb3b;
            padding: 2px 0;
            border-radius: 3px;
            transition: background-color 0.3s ease;
        }
        
        .original-text .reading {
            background-color: #4caf50;
            color: white;
            padding: 2px 0;
            border-radius: 3px;
            animation: pulse-reading 1.5s infinite;
        }
        
        @keyframes pulse-reading {
            0% { background-color: #4caf50; }
            50% { background-color: #2e7d32; }
            100% { background-color: #4caf50; }
        }
        
        .text-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .text-btn {
            padding: 8px 15px;
            background: #3a1c71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .text-btn:hover {
            background: #5c2a9d;
            transform: translateY(-2px);
        }
        
        .text-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .page-btn {
            padding: 8px 15px;
            background: #3a1c71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover {
            background: #5c2a9d;
            transform: translateY(-2px);
        }
        
        .page-btn.active {
            background: #fdbb2d;
            color: #333;
            font-weight: bold;
        }
        
        .question-container {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .question {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            line-height: 1.5;
        }
        
        .answer-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 15px;
        }
        
        .method-btn {
            padding: 8px 15px;
            background: #e9ecef;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .method-btn.active {
            background: #3a1c71;
            color: white;
        }
        
        .voice-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .text-answer-container {
            margin: 15px 0;
            display: none;
        }
        
        .text-answer-container.active {
            display: block;
        }
        
        .text-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }
        
        .text-input:focus {
            border-color: #3a1c71;
            outline: none;
        }
        
        .submit-btn {
            padding: 10px 20px;
            background: #3a1c71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            background: #5c2a9d;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #3a1c71;
            color: white;
        }
        
        .btn-primary:hover {
            background: #4d288f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .recording {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            color: #e74c3c;
            margin-top: 10px;
        }
        
        .pulse {
            width: 15px;
            height: 15px;
            background: #e74c3c;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.9); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.9); opacity: 0.7; }
        }
        
        .answer-feedback {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .score-board {
            background: linear-gradient(90deg, #3a1c71, #5c2a9d);
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .score {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .progress-bar {
            height: 10px;
            background: #eee;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.2);
            margin-top: 30px;
            border-radius: 10px;
        }
        
        @media (max-width: 992px) {
            .content {
                flex-direction: column;
            }
            
            .text-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
            
            .voice-controls, .answer-methods {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                justify-content: center;
            }
            
            .text-controls {
                flex-direction: column;
            }
        }
        
        .text-note {
            font-style: italic;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }
        
        .section-title {
            color: #3a1c71;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .reading-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }
        
        .compact-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .text-answer-next {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-dragon"></i> 西游记第五回问答挑战</h1>
            <p class="subtitle">乱蟠桃大圣偷丹　反天宫诸神捉怪</p>
        </header>
        
        <div class="content">
            <div class="text-section">
                <h2><i class="fas fa-book"></i> 西游记第五回原文</h2>
                <div class="text-container">
                    <div class="section-title" id="section-title">第一段：齐天大圣的逍遥生活</div>
                    
                    <div class="text-controls">
                        <button class="text-btn" id="read-selection">
                            <i class="fas fa-volume-up"></i> 朗读选中内容
                        </button>
                        <button class="text-btn" id="read-all">
                            <i class="fas fa-book-reader"></i> 朗读全部
                        </button>
                        <button class="text-btn" id="stop-reading" disabled>
                            <i class="fas fa-stop"></i> 停止朗读
                        </button>
                    </div>
                    
                    <div class="original-text" id="text-content">
                        <!-- 文本内容将通过JavaScript动态加载 -->
                    </div>
                    
                    <div class="reading-controls">
                        <button class="text-btn" id="prev-sentence">
                            <i class="fas fa-arrow-left"></i> 上一句
                        </button>
                        <button class="text-btn" id="next-sentence">
                            下一句 <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    
                    <p class="text-note">选择文本后点击"朗读选中内容"，或使用下方分页按钮浏览完整内容</p>
                </div>
                
                <div class="pagination" id="pagination">
                    <!-- 分页按钮将通过JavaScript动态生成 -->
                </div>
            </div>
            
            <div class="qa-section">
                <h2><i class="fas fa-question-circle"></i> 问答挑战</h2>
                <div class="question-container">
                    <div class="question" id="current-question">问题加载中...</div>
                    
                    <div class="answer-methods">
                        <button class="method-btn active" id="voice-method">
                            <i class="fas fa-microphone"></i> 语音回答
                        </button>
                        <button class="method-btn" id="text-method">
                            <i class="fas fa-keyboard"></i> 文字回答
                        </button>
                    </div>
                    
                    <div class="voice-controls" id="voice-controls">
                        <div class="compact-controls">
                            <button class="btn btn-primary" id="start-record">
                                <i class="fas fa-microphone"></i> 开始录音回答
                            </button>
                            <button class="btn btn-secondary" id="next-question">
                                <i class="fas fa-forward"></i> 下一题
                            </button>
                        </div>
                    </div>
                    
                    <div class="text-answer-container" id="text-answer-container">
                        <input type="text" class="text-input" id="text-answer" placeholder="请输入您的答案...">
                        <div class="text-answer-next">
                            <button class="submit-btn" id="submit-text-answer">
                                <i class="fas fa-paper-plane"></i> 提交答案
                            </button>
                            <button class="btn btn-secondary" id="text-next-question">
                                <i class="fas fa-forward"></i> 下一题
                            </button>
                        </div>
                    </div>
                    
                    <div class="recording" id="recording-indicator" style="display: none;">
                        <div class="pulse"></div>
                        <span>正在录音...请回答问题</span>
                    </div>
                    
                    <div id="answer-feedback"></div>
                </div>
                
                <div class="score-board">
                    <h3><i class="fas fa-trophy"></i> 当前得分</h3>
                    <div class="score" id="score">0</div>
                    <div class="progress-bar">
                        <div class="progress" id="progress-bar"></div>
                    </div>
                    <p>已回答: <span id="answered">0</span>/<span id="total-questions">20</span> 题</p>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>交互式问答系统 | 基于西游记第五回内容</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 西游记第五回的十段原文
            const textPages = [
                {
                    title: "第一段：齐天大圣的逍遥生活",
                    content: `话表齐天大圣到底是个妖猴，更不知官衔品从，也不较俸禄高低，但只注名便了。那齐天府下二司仙吏，早晚扶侍，只知日食三餐，夜眠一榻，无事牵萦，自由自在。闲时节会友游宫，交朋结义。见三清，称个“老”字；逢四帝，道个“陛下”。与那九曜星、五方将、二十八宿、四大天王、十二元辰、五方五老、普天星相、河汉群神，俱只以弟兄相待，彼此称呼。今日东游，明日西荡，云去云来，行踪不定。`
                },
                {
                    title: "第二段：奉命掌管蟠桃园",
                    content: `一日，玉帝早朝，班部中闪出许旌阳真人，俯囟启奏道：“今有齐天大圣，无事闲游，结交天上众星宿，不论高低，俱称朋友。恐后闲中生事，不若与他一件事管，庶免别生事端。”玉帝闻言，即时宣诏。那猴王欣欣然而至，道：“陛下，诏老孙有何升赏？”玉帝道：“朕见你身闲无事，与你件执事。你且权管那蟠桃园，早晚好生在意。”大圣欢喜谢恩，朝上唱喏而退。`
                },
                {
                    title: "第三段：初探蟠桃园",
                    content: `他等不得穷忙，即入蟠桃园内查勘。本园中有个土地拦住，问道：“大圣何往？”大圣道：“吾奉玉帝点差，代管蟠桃园，今来查勘也。”那土地连忙施礼，即呼那一班锄树力士、运水力士、修桃力士、打扫力士都来见大圣磕头，引他进去。但见那：夭夭灼灼，颗颗株株。夭夭灼灼花盈树，颗颗株株果压枝。果压枝头垂锦弹，花盈树上簇胭脂。时开时结千年熟，无夏无冬万载迟。先熟的，酡颜醉脸；还生的，带蒂青皮。凝烟肌带绿，映日显丹姿。树下奇葩并异卉，四时不谢色齐齐。左右楼台并馆舍，盘空常见罩云霓。不是玄都凡俗种，瑶池王母自栽培。大圣看玩多时，问土地道：“此树有多少株数？”土地道：“有三千六百株：前面一千二百株，花微果小，三千年一熟，人吃了成仙了道，体健身轻。中间一千二百株，层花甘实，六千年一熟，人吃了霞举飞升，长生不老。后面一千二百株，紫纹缃核，九千年一熟，人吃了与天地齐寿，日月同庚。”大圣闻言，欢喜无任，当日查明了株数，点看了亭阁，回府。自此后，三五日一次赏玩，也不交友，也不他游。`
                },
                {
                    title: "第四段：大圣偷桃",
                    content: `一日，见那老树枝头，桃熟大半，他心里要吃个尝新。奈何本园土地、力士并齐天府仙吏紧随不便。忽设一计道：“汝等且出门外伺候，让我在这亭上少憩片时。”那众仙果退。只见那猴王脱了冠着服，爬上大树，拣那熟透的大桃，摘了许多，就在树枝上自在受用。吃了一饱，却跳下来，簪冠著服，唤众等仪从回府。迟三二日，又去设法偷桃，尽他享用。`
                },
                {
                    title: "第五段：七仙女摘桃遇大圣",
                    content: `一朝，王母娘娘设宴，大开宝阁，瑶池中做“蟠桃胜会”，即着那红衣仙女、素衣仙女、青衣仙女、皂衣仙女、紫衣仙女、黄衣仙女、绿衣仙女，各顶花篮，去蟠桃园摘桃建会。七衣仙女直至园门首，只见蟠桃园土地、力士同齐天府二司仙吏，都在那里把门。仙女近前道：“我等奉王母懿旨，到此携桃设宴。”土地道：“仙娥且住。今岁不比往年了，玉帝点差齐天大圣在此督理，须是报大圣得知，方敢开园。”仙女道：“大圣何在？”土地道：“大圣在园内，因困倦，自家在亭子上睡哩。”仙女道：“既如此，寻他去来，不可延误。”土地即与同进。寻至花亭不见，只有衣冠在亭，不知何往。四下里都没寻处。原来大圣耍了一会，吃了几个桃子，变做二寸长的个人儿，在那大树梢头浓叶之下睡着了。七衣仙女道：“我等奉旨前来，寻不见大圣，怎敢空回？”旁有仙吏道：“仙娥既奉旨来，不必迟疑。我大圣闲游惯了，想是出园会友去了。汝等且去摘桃，我们替你回话便是。”那仙女依言，入树林之下摘桃。先在前树摘了二篮，又在中树摘了三篮；到后树上摘取，只见那树上花果稀疏，止有几个毛蒂青皮的。原来熟的都是猴王吃了。七仙女张望东西，只见南枝上止有一个半红半白的桃子。青衣女用手扯下枝来，红衣女摘了，却将枝子望上一放。原来那大圣变化了，正睡在此枝，被他惊醒。`
                },
                {
                    title: "第六段：大圣询问蟠桃会",
                    content: `大圣即现本相，耳朵内掣出金箍棒，幌一幌，碗来粗细，咄的一声道：“你是那方怪物，敢大胆偷摘我桃！”慌得那七仙女一齐跪下道：“大圣息怒。我等不是妖怪，乃王母娘娘差来的七衣仙女，摘取仙桃，大开宝阁，做‘蟠桃胜会’。适至此间，先见了本园土地等神，寻大圣不见。我等恐迟了王母懿旨，是以等不得大圣，故先在此摘桃，万望恕罪。”大圣闻言，回嗔作喜道：“仙娥请起。王母开阁设宴，请的是谁？”仙女道：“上会自有旧规。请的是西天佛老、菩萨、罗汉，南方南极观音，东方崇恩圣帝，十洲三岛仙翁，北方北极玄灵，中央黄极黄角大仙，这个是五方五老。还有五斗星君，上八洞三清、四帝、太乙天仙等众，中八洞玉皇、九垒、海岳神仙，下八洞幽冥教主、注世地仙。各宫各殿大小尊神，俱一齐赴蟠桃嘉会。”大圣笑道：“可请我么？”仙女说：“不曾听得说。”大圣道：“我乃齐天大圣，就请我老孙做个尊席，有何不可？”仙女道：“此是上会会规，今会不知如何。”大圣道：“此言也是，难怪汝等。你且立下，待老孙先去打听个消息，看可请老孙不请。”`
                },
                {
                    title: "第七段：大圣定住七仙女",
                    content: `好大圣，捻着诀，念声咒语，对众仙女道：“住！住！住！”这原来是个定身法，把那七衣仙女一个个睖睖睁睁，白着眼，都站在桃树之下。大圣纵朵祥云，跳出园内，竟奔瑶池路上而去。正行时，只见那壁厢：一天瑞霭光摇曳，五色祥云飞不绝。白鹤声鸣振九皋，紫芝色秀分千叶。中间现出一尊仙，相貌天然丰采别。神舞虹霓幌汉霄，腰悬宝录无生灭。名称赤脚大罗仙，特赴蟠桃添寿节。那赤脚大仙觌面撞见大圣，大圣低头定计，赚哄真仙，他要暗去赴会，却问：“老道何往？”大仙道：“蒙王母见招，去赴蟠桃嘉会。”大圣道：“老道不知。玉帝因老孙筋斗云疾，着老孙五路邀请列位，先至通明殿下演礼，后方去赴宴。”大仙是个光明正大之人，就以他的诳语作真。道：“常年就在瑶池演礼谢恩，如何先去通明殿演礼，方去瑶池赴会？”无奈，只得拨转祥云，径往通明殿去了。`
                },
                {
                    title: "第八段：大闹蟠桃会",
                    content: `大圣驾着云，念声咒语，摇身一变，就变做赤脚大仙模样，前奔瑶池。不多时，直至宝阁，按住云头，轻轻移步，走入里面。只见那里：琼香缭绕，瑞霭缤纷，瑶台铺彩结，宝阁散氤氲。凤翥鸾腾形缥缈，金花玉萼影浮沉。上排着九凤丹霞扆，八宝紫霓墩。五彩描金桌，千花碧玉盆。桌上有龙肝和凤髓，熊掌与猩唇。珍馐百味般般美，异果嘉肴色色新。那里铺设得齐齐整整，却还未有仙来。这大圣点看不尽，忽闻得一阵酒香扑鼻；忽转头，见右壁厢长廊之下，有几个造酒的仙官，盘糟的力士，领几个运水的道人，烧火的童子，在那里洗缸刷瓮，已造成了玉液琼浆，香醪佳酿。大圣止不住口角流涎，就要去吃，奈何那些人都在这里。他就弄个神通，把毫毛拔下几根，丢入口中嚼碎，喷将出去，念声咒语，叫“变！”即变做几个瞌睡虫，奔在众人脸上。你看那伙人，手软头低，闭眉合眼，丢了执事，都去盹睡。大圣却拿了些百味珍馐，佳肴异品，走入长廊里面，就着缸，挨着瓮，放开量，痛饮一番。吃勾了多时，酕醄醉了。自揣自摸道：“不好！不好！再过会，请的客来，却不怪我？一时拿住，怎生是好？不如早回府中睡去也。”`
                },
                {
                    title: "第九段：偷吃太上老君金丹",
                    content: `好大圣：摇摇摆摆，仗着酒，任情乱撞，一会把路差了；不是齐天府，却是兜率天宫。一见了，顿然醒悟道：“兜率宫是三十三天之上，乃离恨天太上老君之处，如何错到此间？——也罢！也罢！一向要来望此老，不曾得来，今趁此残步，就望他一望也好。”即整衣撞进去，那里不见老君，四无人迹。原来那老君与燃灯古佛在三层高阁朱陵丹台上讲道，众仙童、仙将、仙官、仙吏，都侍立左右听讲。这大圣直至丹房里面，寻访不遇，但见丹灶之旁，炉中有火。炉左右安放着五个葫芦，葫芦里都是炼就的金丹。大圣喜道：“此物乃仙家之至宝，老孙自了道以来，识破了内外相同之理，也要些金丹济入，不期到家无暇；今日有缘，却又撞着此物，趁老子不在，等我吃他几丸尝新。”他就把那葫芦都倾出来，就都吃了，如吃炒豆相似。一时间丹满酒醒，又自己揣度道：“不好！不好！这场祸，比天还大；若惊动玉帝，性命难存。走！走！走！不如下界为王去也！”他就跑出兜率宫，不行旧路，从西天门，使个隐身法逃去。即按云头，回至花果山界。`
                },
                {
                    title: "第十段：天兵天将下界捉拿",
                    content: `但见那旌旗闪灼，戈戟光辉，原来是四健将与七十二洞妖王，在那里演习武艺。大圣高叫道：“小的们！我来也！”众怪丢了器械，跪倒道：“大圣好宽心！丢下我等许久，不来相顾！”大圣道：“没多时！没多时！”且说且行，径入洞天深处。四健将打扫安歇叩头礼拜毕。俱道：“大圣在天这百十年，实受何职？”大圣笑道：“我记得才半年光景，怎么就说百十年话？”健将道：“在天一日，即在下方一年也。”大圣道：“且喜这番玉帝相爱，果封做‘齐天大圣’，起一座齐天府，又设安静、宁神二司，司设仙吏侍卫。向后见我无事，着我看管蟠桃园。近因王母娘娘设‘蟠桃大会’，未曾请我，是我不待他请，先赴瑶池，把他那仙品、仙酒，都是我偷吃了。走出瑶池，踉踉跄跄误入老君宫阙，又把他五个葫芦金丹也偷吃了。但恐玉帝见罪，方才走出天门来也。”众怪闻言大喜。即安排酒果接风，将椰酒满斟一石碗奉上，大圣喝了一口，即咨牙咧嘴道：“不好吃！不好吃！”崩、巴二将道：“大圣在天宫，吃了仙酒、仙肴，是以椰酒不甚美口。常言道：‘美不美，乡中水。’”大圣道：“你们就是‘亲不亲，故乡人。’我今早在瑶池中受用时，见那长廊之下，有许多瓶罐，都是那玉液琼浆。你们都不曾尝着。待我再去偷他几瓶回来，你们各饮半杯，一个个也长生不老。”众猴欢喜不胜。大圣即出洞门，又翻一筋斗，使个隐身法，径至蟠桃会上。进瑶池宫阙，只见那几个造酒、盘糟、运水、烧火的，还鼾睡未醒。他将大的从左右胁下挟了两个，两手提了两个，即拨转云头回来，会众猴在于洞中，就做个“仙酒会”，各饮了几杯，快乐不题。`
                }
            ];
            
            // 问题和答案数据 - 每段2个问题，共20题
            const questions = [
                // 第一段问题
                {
                    question: "齐天大圣在天宫过着怎样的生活？",
                    answer: "自由自在"
                },
                {
                    question: "齐天大圣如何称呼三清和四帝？",
                    answer: "见三清称个老字，逢四帝道个陛下"
                },
                
                // 第二段问题
                {
                    question: "谁向玉帝建议给孙悟空一件事管？",
                    answer: "许旌阳真人"
                },
                {
                    question: "玉帝让孙悟空掌管什么？",
                    answer: "蟠桃园"
                },
                
                // 第三段问题
                {
                    question: "蟠桃园有多少株蟠桃树？",
                    answer: "三千六百株"
                },
                {
                    question: "九千年一熟的蟠桃吃了有什么效果？",
                    answer: "与天地齐寿，日月同庚"
                },
                
                // 第四段问题
                {
                    question: "孙悟空用什么计策偷吃蟠桃？",
                    answer: "让仙吏门外伺候，自己在亭上少憩"
                },
                {
                    question: "孙悟空如何偷吃蟠桃？",
                    answer: "脱了冠着服，爬上大树摘桃吃"
                },
                
                // 第五段问题
                {
                    question: "七衣仙女奉谁的命令来摘蟠桃？",
                    answer: "王母娘娘"
                },
                {
                    question: "孙悟空变成什么躲在树上？",
                    answer: "二寸长的个人儿"
                },
                
                // 第六段问题
                {
                    question: "蟠桃会邀请的五方五老包括哪些？",
                    answer: "西天佛老菩萨罗汉、南方南极观音、东方崇恩圣帝、十洲三岛仙翁、北方北极玄灵、中央黄极黄角大仙"
                },
                {
                    question: "孙悟空问七仙女蟠桃会是否邀请自己，七仙女如何回答？",
                    answer: "不曾听得说"
                },
                
                // 第七段问题
                {
                    question: "孙悟空用什么法术定住了七仙女？",
                    answer: "定身法"
                },
                {
                    question: "孙悟空如何骗赤脚大仙？",
                    answer: "谎称玉帝让他邀请众仙先去通明殿演礼"
                },
                
                // 第八段问题
                {
                    question: "孙悟空用什么方法让造酒的仙官们睡着？",
                    answer: "变出瞌睡虫"
                },
                {
                    question: "孙悟空在瑶池痛饮什么？",
                    answer: "玉液琼浆，香醪佳酿"
                },
                
                // 第九段问题
                {
                    question: "孙悟空在哪里偷吃了金丹？",
                    answer: "兜率宫"
                },
                {
                    question: "孙悟空如何形容吃金丹的感觉？",
                    answer: "如吃炒豆相似"
                },
                
                // 第十段问题
                {
                    question: "孙悟空回到花果山后，众猴用什么酒为他接风？",
                    answer: "椰酒"
                },
                {
                    question: "孙悟空为什么觉得花果山的酒不好喝？",
                    answer: "在天上喝了仙酒仙肴"
                }
            ];
            
            let currentQuestionIndex = 0;
            let currentPageIndex = 0;
            let score = 0;
            let answeredQuestions = 0;
            const totalQuestions = questions.length;
            
            const textContentElement = document.getElementById('text-content');
            const sectionTitleElement = document.getElementById('section-title');
            const paginationElement = document.getElementById('pagination');
            const questionElement = document.getElementById('current-question');
            const scoreElement = document.getElementById('score');
            const answeredElement = document.getElementById('answered');
            const totalQuestionsElement = document.getElementById('total-questions');
            const progressBar = document.getElementById('progress-bar');
            const feedbackElement = document.getElementById('answer-feedback');
            const recordingIndicator = document.getElementById('recording-indicator');
            const startRecordButton = document.getElementById('start-record');
            const nextQuestionButton = document.getElementById('next-question');
            const textNextQuestionButton = document.getElementById('text-next-question');
            
            // 文字回答相关元素
            const voiceMethodBtn = document.getElementById('voice-method');
            const textMethodBtn = document.getElementById('text-method');
            const voiceControls = document.getElementById('voice-controls');
            const textAnswerContainer = document.getElementById('text-answer-container');
            const textAnswerInput = document.getElementById('text-answer');
            const submitTextAnswerBtn = document.getElementById('submit-text-answer');
            
            // 朗读功能相关元素
            const readSelectionBtn = document.getElementById('read-selection');
            const readAllBtn = document.getElementById('read-all');
            const stopReadingBtn = document.getElementById('stop-reading');
            const prevSentenceBtn = document.getElementById('prev-sentence');
            const nextSentenceBtn = document.getElementById('next-sentence');
            
            // 初始化显示
            totalQuestionsElement.textContent = totalQuestions;
            displayQuestion();
            renderTextPages();
            updatePagination();
            
            // 渲染文本内容
            function renderTextPages() {
                sectionTitleElement.textContent = textPages[currentPageIndex].title;
                textContentElement.innerHTML = textPages[currentPageIndex].content.replace(/\n/g, '<br>');
            }
            
            // 创建分页按钮
            function updatePagination() {
                paginationElement.innerHTML = '';
                for (let i = 0; i < textPages.length; i++) {
                    const button = document.createElement('button');
                    button.className = `page-btn ${i === currentPageIndex ? 'active' : ''}`;
                    button.textContent = `第${i+1}段`;
                    button.addEventListener('click', () => {
                        currentPageIndex = i;
                        renderTextPages();
                        updatePagination();
                        // 切换到对应段落的问题
                        currentQuestionIndex = i * 2;
                        displayQuestion();
                        feedbackElement.innerHTML = '';
                    });
                    paginationElement.appendChild(button);
                }
            }
            
            // 显示当前问题
            function displayQuestion() {
                if (currentQuestionIndex < totalQuestions) {
                    questionElement.textContent = questions[currentQuestionIndex].question;
                } else {
                    questionElement.textContent = "已完成所有问题！";
                    startRecordButton.disabled = true;
                    nextQuestionButton.disabled = true;
                    submitTextAnswerBtn.disabled = true;
                    textNextQuestionButton.disabled = true;
                }
            }
            
            // 检查答案
            function checkAnswer(userAnswer) {
                const correctAnswer = questions[currentQuestionIndex].answer.toLowerCase();
                const userAnswerLower = userAnswer.toLowerCase();
                
                // 简单匹配逻辑
                if (userAnswerLower.includes(correctAnswer) || 
                    correctAnswer.includes(userAnswerLower)) {
                    return true;
                }
                
                return false;
            }
            
            // 更新分数和进度
            function updateScore(isCorrect) {
                if (isCorrect) {
                    score += 5;
                    feedbackElement.innerHTML = `<div class="answer-feedback correct"><i class="fas fa-check-circle"></i> 回答正确！+5分</div>`;
                } else {
                    feedbackElement.innerHTML = `<div class="answer-feedback incorrect"><i class="fas fa-times-circle"></i> 回答错误！正确答案: ${questions[currentQuestionIndex].answer}</div>`;
                }
                
                scoreElement.textContent = score;
                answeredQuestions++;
                answeredElement.textContent = answeredQuestions;
                
                // 更新进度条
                const progressPercentage = (answeredQuestions / totalQuestions) * 100;
                progressBar.style.width = progressPercentage + '%';
            }
            
            // 切换回答方式
            voiceMethodBtn.addEventListener('click', function() {
                voiceMethodBtn.classList.add('active');
                textMethodBtn.classList.remove('active');
                voiceControls.style.display = 'flex';
                textAnswerContainer.style.display = 'none';
            });
            
            textMethodBtn.addEventListener('click', function() {
                textMethodBtn.classList.add('active');
                voiceMethodBtn.classList.remove('active');
                voiceControls.style.display = 'none';
                textAnswerContainer.style.display = 'block';
            });
            
            // 提交文字答案
            submitTextAnswerBtn.addEventListener('click', function() {
                const answer = textAnswerInput.value.trim();
                if (answer === '') {
                    alert('请输入答案');
                    return;
                }
                
                const isCorrect = checkAnswer(answer);
                updateScore(isCorrect);
                
                // 清空输入框
                textAnswerInput.value = '';
            });
            
            // 按回车键提交答案
            textAnswerInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitTextAnswerBtn.click();
                }
            });
            
            // 语音合成功能
            let speechSynthesis = window.speechSynthesis;
            let speechUtterance = null;
            let isReading = false;
            let currentSentenceIndex = 0;
            let sentences = [];
            
            // 初始化语音合成
            function initSpeechSynthesis() {
                if (!speechSynthesis) {
                    console.error("您的浏览器不支持语音合成功能");
                    readSelectionBtn.disabled = true;
                    readAllBtn.disabled = true;
                    stopReadingBtn.disabled = true;
                    return;
                }
                
                // 设置中文语音
                speechSynthesis.getVoices();
                
                // 事件监听
                readSelectionBtn.addEventListener('click', readSelectedText);
                readAllBtn.addEventListener('click', readAllText);
                stopReadingBtn.addEventListener('click', stopReading);
                prevSentenceBtn.addEventListener('click', readPreviousSentence);
                nextSentenceBtn.addEventListener('click', readNextSentence);
                
                // 语音合成结束事件
                if (speechUtterance) {
                    speechUtterance.onend = function() {
                        isReading = false;
                        stopReadingBtn.disabled = true;
                    };
                }
            }
            
            // 朗读选中的文本
            function readSelectedText() {
                const selection = window.getSelection();
                if (selection.toString().trim() === '') {
                    alert('请先选择要朗读的文本');
                    return;
                }
                
                stopReading();
                
                const selectedText = selection.toString();
                speakText(selectedText);
                
                // 高亮选中的文本
                const range = selection.getRangeAt(0);
                const highlightedText = document.createElement('span');
                highlightedText.className = 'highlight';
                range.surroundContents(highlightedText);
            }
            
            // 朗读全部文本
            function readAllText() {
                stopReading();
                const fullText = textContentElement.textContent;
                sentences = splitIntoSentences(fullText);
                currentSentenceIndex = 0;
                readCurrentSentence();
            }
            
            // 停止朗读
            function stopReading() {
                if (speechSynthesis && isReading) {
                    speechSynthesis.cancel();
                    isReading = false;
                    stopReadingBtn.disabled = true;
                    
                    // 移除所有高亮
                    const highlights = textContentElement.querySelectorAll('.reading');
                    highlights.forEach(el => {
                        el.classList.remove('reading');
                    });
                }
            }
            
            // 将文本分割成句子
            function splitIntoSentences(text) {
                // 简单的中文句子分割
                return text.split(/(?<=[。！？；])/).filter(s => s.trim() !== '');
            }
            
            // 朗读当前句子
            function readCurrentSentence() {
                if (currentSentenceIndex >= sentences.length) {
                    return;
                }
                
                stopReading();
                
                const sentence = sentences[currentSentenceIndex];
                speakText(sentence);
                
                // 高亮当前句子
                highlightCurrentSentence(sentence);
                
                isReading = true;
                stopReadingBtn.disabled = false;
            }
            
            // 朗读上一句
            function readPreviousSentence() {
                if (currentSentenceIndex > 0) {
                    currentSentenceIndex--;
                    readCurrentSentence();
                }
            }
            
            // 朗读下一句
            function readNextSentence() {
                if (currentSentenceIndex < sentences.length - 1) {
                    currentSentenceIndex++;
                    readCurrentSentence();
                }
            }
            
            // 高亮当前句子
            function highlightCurrentSentence(sentence) {
                // 移除之前的高亮
                const existingHighlights = textContentElement.querySelectorAll('.reading');
                existingHighlights.forEach(el => {
                    el.classList.remove('reading');
                });
                
                // 查找并高亮当前句子
                const text = textContentElement.textContent;
                const startIndex = text.indexOf(sentence);
                if (startIndex !== -1) {
                    const endIndex = startIndex + sentence.length;
                    
                    let charCount = 0;
                    let startNode = null, endNode = null;
                    let startOffset = 0, endOffset = 0;
                    
                    // 查找文本节点
                    function findTextNodes(node) {
                        if (node.nodeType === Node.TEXT_NODE) {
                            const nextCount = charCount + node.textContent.length;
                            if (!startNode && nextCount > startIndex) {
                                startNode = node;
                                startOffset = startIndex - charCount;
                            }
                            if (!endNode && nextCount >= endIndex) {
                                endNode = node;
                                endOffset = endIndex - charCount;
                            }
                            charCount = nextCount;
                        } else {
                            for (let i = 0; i < node.childNodes.length; i++) {
                                if (startNode && endNode) break;
                                findTextNodes(node.childNodes[i]);
                            }
                        }
                    }
                    
                    findTextNodes(textContentElement);
                    
                    if (startNode && endNode) {
                        const range = document.createRange();
                        range.setStart(startNode, startOffset);
                        range.setEnd(endNode, endOffset);
                        
                        const highlight = document.createElement('span');
                        highlight.className = 'reading';
                        range.surroundContents(highlight);
                        
                        // 滚动到高亮位置
                        highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }
            
            // 使用语音合成朗读文本
            function speakText(text) {
                if (speechSynthesis) {
                    speechUtterance = new SpeechSynthesisUtterance(text);
                    speechUtterance.lang = 'zh-CN';
                    speechUtterance.rate = 0.9;
                    speechUtterance.pitch = 1;
                    
                    speechUtterance.onend = function() {
                        isReading = false;
                        stopReadingBtn.disabled = true;
                    };
                    
                    speechSynthesis.speak(speechUtterance);
                    isReading = true;
                    stopReadingBtn.disabled = false;
                }
            }
            
            // 语音识别功能
            let recognition = null;
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'zh-CN';
                
                recognition.onstart = function() {
                    recordingIndicator.style.display = 'flex';
                    startRecordButton.innerHTML = '<i class="fas fa-microphone-slash"></i> 停止录音';
                    startRecordButton.disabled = false;
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    const isCorrect = checkAnswer(transcript);
                    updateScore(isCorrect);
                };
                
                recognition.onerror = function(event) {
                    console.error('语音识别错误:', event.error);
                    feedbackElement.innerHTML = `<div class="answer-feedback incorrect"><i class="fas fa-exclamation-triangle"></i> 语音识别错误，请重试</div>`;
                };
                
                recognition.onend = function() {
                    recordingIndicator.style.display = 'none';
                    startRecordButton.innerHTML = '<i class="fas fa-microphone"></i> 开始录音回答';
                    startRecordButton.disabled = false;
                };
                
                startRecordButton.addEventListener('click', function() {
                    try {
                        if (startRecordButton.innerHTML.includes('开始录音')) {
                            recognition.start();
                        } else {
                            recognition.stop();
                        }
                    } catch (error) {
                        feedbackElement.innerHTML = `<div class="answer-feedback incorrect"><i class="fas fa-exclamation-triangle"></i> 无法启动语音识别: ${error.message}</div>`;
                    }
                });
            } else {
                startRecordButton.disabled = true;
                feedbackElement.innerHTML = '<div class="answer-feedback incorrect"><i class="fas fa-exclamation-triangle"></i> 您的浏览器不支持语音识别功能</div>';
            }
            
            // 下一题按钮（语音模式）
            nextQuestionButton.addEventListener('click', function() {
                goToNextQuestion();
            });
            
            // 下一题按钮（文字模式）
            textNextQuestionButton.addEventListener('click', function() {
                goToNextQuestion();
            });
            
            // 转到下一题
            function goToNextQuestion() {
                currentQuestionIndex++;
                // 如果当前段落的2个问题已回答完，自动切换到下一段
                if (currentQuestionIndex % 2 === 0 && currentQuestionIndex < totalQuestions) {
                    currentPageIndex = Math.floor(currentQuestionIndex / 2);
                    renderTextPages();
                    updatePagination();
                }
                feedbackElement.innerHTML = '';
                displayQuestion();
            }
            
            // 初始化语音合成功能
            initSpeechSynthesis();
        });
    </script>
</body>
</html>